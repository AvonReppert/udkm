
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>udkm.pxs.functions &#8212; udkm 0.1</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">udkm 0.1</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/AleksUDKM/udkm">
   github project page
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pxs.html">
   pxs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../moke.html">
   moke
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../tools.html">
   tools
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <h1>Source code for udkm.pxs.functions</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This skript contains all basic functions used to evaluate pxs x-ray diffraction data.</span>

<span class="sd">-- Further information --</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">udkm.tools.functions</span> <span class="k">as</span> <span class="nn">tools</span>
<span class="kn">import</span> <span class="nn">udkm.tools.colors</span> <span class="k">as</span> <span class="nn">color</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">lmfit</span> <span class="k">as</span> <span class="nn">lm</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">PXS_WL</span> <span class="o">=</span> <span class="mf">1.5418</span>             <span class="c1"># Cu K-alpha wavelength in [Ang]</span>
<span class="n">PXS_K</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">PXS_WL</span>      <span class="c1"># absolute value of the incident k-vector in [1/Ang]</span>
<span class="n">PIXELSIZE</span> <span class="o">=</span> <span class="mf">0.172e-3</span>        <span class="c1"># size of pilaus pixel in [m]</span>


<div class="viewcode-block" id="get_scan_parameter"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.get_scan_parameter">[docs]</a><span class="k">def</span> <span class="nf">get_scan_parameter</span><span class="p">(</span><span class="n">ref_file</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function writes the measurement parameters of the &#39;number&#39;. measurement</span>
<span class="sd">    from the reference file &#39;ref_file&#39; into a dictionary and returns it. Necessary</span>
<span class="sd">    entrys of the reference file are: &#39;identifier&#39;: combination of date and time,</span>
<span class="sd">    &#39;date&#39;: date of measurement, &#39;time&#39;: time of measurement, &#39;temperature&#39;: start</span>
<span class="sd">    temperature in [K], &#39;fluence&#39; - incident excitation fluence in [mJ/cm2],</span>
<span class="sd">    &#39;time_zero&#39;: delay of pump-probe overlap in [ps], &#39;distance&#39;: distance between</span>
<span class="sd">    sample and detector in [m].</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ref_file : str</span>
<span class="sd">        File name of the reference file storing information about measurement.</span>
<span class="sd">    number : int</span>
<span class="sd">        The number of the measurement equivalent to row in the reference file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scan_parameters : dictionary</span>
<span class="sd">        Contains the parameters of the measurement. Always included keys are: &#39;identifier&#39;:</span>
<span class="sd">        combination of date and time,&#39;date&#39;: date of measurement, &#39;time&#39;: time of</span>
<span class="sd">        measurement, &#39;temperature&#39;: start temperature in [K], &#39;fluence&#39; - incident</span>
<span class="sd">        excitation fluence in [mJ/cm2], &#39;time_zero&#39;: delay of pump-probe overlap in [ps],</span>
<span class="sd">        &#39;distance&#39;: distance between sample and detector in [m].</span>
<span class="sd">        Optinal keys are: &#39;power&#39;: laser power in [mW], &#39;spot_size_x&#39;: FWHM of laser spot</span>
<span class="sd">        along x-direction in [mum], &#39;spot_size_y&#39;: FWHM of laser spot along</span>
<span class="sd">        y-direction in [mum], &#39;peak&#39;: name of material of measured Bragg peak,</span>
<span class="sd">        &#39;magnetic_field&#39;: applied magnetic field in [T], &#39;wavelength&#39;: excitation</span>
<span class="sd">        wavelength in [nm], &#39;double_pulse&#39;: was it &#39;first&#39;, &#39;second&#39; or &#39;both&#39; excitation pulses,</span>
<span class="sd">        &#39;z_pos&#39;: z-position on the sample in [mm], &#39;y_pos&#39;: y-position on the</span>
<span class="sd">        sample in [mm], &#39;pulse_length&#39;: length of the pump-pulse in [ps], &#39;colinear_exc&#39;:</span>
<span class="sd">        wether or not pump and probe were collinear.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; get_scan_parameter(&#39;reference.txt&#39;, 1) = {&#39;number&#39;: 1,</span>
<span class="sd">                                                  &#39;identifier&#39;: &#39;20211123174703&#39;,</span>
<span class="sd">                                                  &#39;date&#39;: &#39;20211123&#39;,</span>
<span class="sd">                                                  &#39;time&#39;: &#39;183037&#39;,</span>
<span class="sd">                                                  &#39;temperature&#39;: 300,</span>
<span class="sd">                                                  &#39;fluence&#39;: 8.0,</span>
<span class="sd">                                                  &#39;distance&#39;: 0.7,</span>
<span class="sd">                                                  &#39;time_zero&#39;: 0.0,</span>
<span class="sd">                                                  &#39;power&#39;: 110,</span>
<span class="sd">                                                  &#39;spot_size_x&#39;: 960,</span>
<span class="sd">                                                  &#39;spot_size_y&#39;: 960,</span>
<span class="sd">                                                  &#39;double_pulse&#39;: first,</span>
<span class="sd">                                                  &#39;pulse_length&#39;: 0.1,</span>
<span class="sd">                                                  &#39;colinear_exc&#39;: no,</span>
<span class="sd">                                                  &#39;wavelength&#39;: 800,</span>
<span class="sd">                                                  &#39;peak&#39;: &#39;W&#39;,</span>
<span class="sd">                                                  &#39;magnetic_field&#39;: 0.0,</span>
<span class="sd">                                                  &#39;z_pos&#39;: -4.52,</span>
<span class="sd">                                                  &#39;y_pos&#39;: 2.25}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">param_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ReferenceData/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ref_file</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_file</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="n">number</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">entry</span> <span class="o">==</span> <span class="s1">&#39;identifier&#39;</span> <span class="ow">or</span> <span class="n">entry</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span> <span class="ow">or</span> <span class="n">entry</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">timestring</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">param_file</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="n">number</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_file</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="n">number</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">params</span></div>


<div class="viewcode-block" id="get_export_parameter"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.get_export_parameter">[docs]</a><span class="k">def</span> <span class="nf">get_export_parameter</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function creates a dictionary that contains parameters for exporting</span>
<span class="sd">    the analysis results. This dictionary contains the key words: &#39;plot_title&#39;:</span>
<span class="sd">    string that contains the measurement number, its date, time, temperature,</span>
<span class="sd">    fluence and material name to link plots to the measurement, &#39;save_path&#39;: string for a folder</span>
<span class="sd">    structure of date and time to save figures and results and &#39;file_name&#39;: string</span>
<span class="sd">    for suitable file names of exported results. Additionally, adjustable plot parameters</span>
<span class="sd">    are initialised by their default values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    params : dictionary</span>
<span class="sd">        This dictionary contains all parameters of the measurement from teh reference file.</span>
<span class="sd">        This function uses the keys: &#39;number&#39;, &#39;identifier&#39;, &#39;date&#39;, &#39;time&#39;, &#39;temperature&#39;,</span>
<span class="sd">        &#39;fluence&#39; and &#39;peak&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    export : dictionary</span>
<span class="sd">        The entrees of this dictionary are used to export and plot the analysed data.</span>
<span class="sd">        The adjustable keys and their initialised default values are: &#39;bool_refresh_data&#39;</span>
<span class="sd">        and &#39;raw_data_path&#39;: should the raw data from the measurement folder are loaded</span>
<span class="sd">        (default: False), &#39;bool_plot_fit&#39;: should the fit of the rocking curve are plotted</span>
<span class="sd">        (default: False), &#39;delay_steps&#39;: xtick step for first delay range, delay of axis break and</span>
<span class="sd">        xtick step for long delays (default: [10, 100, 200]), &#39;bool_plot_2D_rocking_semilogy&#39;:</span>
<span class="sd">        logarithmic or linear norm of transient rocking curves (default: True), &#39;bool_plot_1D_rocking_semilogy&#39;:</span>
<span class="sd">        logarithmic or linear norm of fitted rocking curve (default: False), &#39;intensity_range_2D&#39;:</span>
<span class="sd">        lower and upper limit of plotted normed transient intensity (default: [0.01, 1]),</span>
<span class="sd">        &#39;intensity_range_1D&#39;: lower and upper limit of plotted normed rocking curve (default: [-0.01, 1]).</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">export</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;plot_title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">+</span> \
        <span class="s1">&#39; | &#39;</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$\,$K&#39;</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span> <span class="o">+</span> \
        <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;fluence&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$\,$mJ/cm$^2$&#39;</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;peak&#39;</span><span class="p">]</span>
    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;identifier&#39;</span><span class="p">]</span>

    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;bool_refresh_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;raw_data_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test/test2/test3/&#39;</span>
    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;bool_plot_fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;bool_plot_2D_rocking_semilogy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;bool_plot_1D_rocking_semilogy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;intensity_range_2D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">export</span><span class="p">[</span><span class="s1">&#39;intensity_range_1D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">export</span></div>


<div class="viewcode-block" id="calc_theta_value"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.calc_theta_value">[docs]</a><span class="k">def</span> <span class="nf">calc_theta_value</span><span class="p">(</span><span class="n">omega_rad</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">pixel</span><span class="p">,</span> <span class="n">centerpixel</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function calculates the corresponding diffraction angle &#39;theta&#39; of a</span>
<span class="sd">    &#39;pixel&#39; of the detector in respect to its &#39;centerpixel&#39;. The &#39;distance&#39; between</span>
<span class="sd">    sample and detector determines the angular space fraction covered by the pixel.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    omega_rad : 0D array</span>
<span class="sd">        the incident angle of x-ray beam in [rad]</span>
<span class="sd">    distance : float</span>
<span class="sd">        distance between sample and detector in [m]</span>
<span class="sd">    pixel : 1D array</span>
<span class="sd">        pixel or pixels for which the theta angle should be calculated</span>
<span class="sd">    centerpixel : integer</span>
<span class="sd">        pixel where Bragg condition &#39;omega&#39; = &#39;theta&#39; is fulfilled</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    theta_rad : 1D array</span>
<span class="sd">        theta angle of the pixel or pixels in [rad]</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; calc_theta_value(0.492, 0.700, 244, 244)[0] = 0.492</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">delta_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">PIXELSIZE</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span>
    <span class="n">theta_rad</span> <span class="o">=</span> <span class="n">omega_rad</span> <span class="o">+</span> <span class="n">delta_theta</span> <span class="o">*</span> <span class="p">(</span><span class="n">pixel</span> <span class="o">-</span> <span class="n">centerpixel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">theta_rad</span></div>


<div class="viewcode-block" id="calc_qx_qz"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.calc_qx_qz">[docs]</a><span class="k">def</span> <span class="nf">calc_qx_qz</span><span class="p">(</span><span class="n">omega_rad</span><span class="p">,</span> <span class="n">theta_rad</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function calculates the qx-qz coordinate in reciprocal space for a</span>
<span class="sd">    given incident and diffraction angle &#39;omega_rad&#39; and &#39;theta_rad&#39;,respectively.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    omega_rad : 0D array</span>
<span class="sd">        the incident angle of x-ray beam in [rad]</span>
<span class="sd">    theta_rad : 1D array</span>
<span class="sd">        the diffraction angle or angles of x-ray beam in [rad]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    qx_val : 1D array</span>
<span class="sd">        in-plane reciprocal space coordinate in [1/Ang]</span>
<span class="sd">    qz_val : 1D array</span>
<span class="sd">        out-off-plane reciprocal space coordinate in [1/Ang]</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; calc_qx_qz(0.492,0.492)[0] = 0.0</span>
<span class="sd">    &gt;&gt;&gt; calc_qx_qz(0.492,0.492)[1] = 3.85</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">qx_val</span> <span class="o">=</span> <span class="n">PXS_K</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omega_rad</span><span class="p">))</span>
    <span class="n">qz_val</span> <span class="o">=</span> <span class="n">PXS_K</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omega_rad</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">qx_val</span><span class="p">,</span> <span class="n">qz_val</span></div>


<div class="viewcode-block" id="get_background"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.get_background">[docs]</a><span class="k">def</span> <span class="nf">get_background</span><span class="p">(</span><span class="n">scan_rocking</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function subtracts the scattering background from the averaged rocking curve</span>
<span class="sd">    before t0 and thereby extracts the intensity distribution associated with the Bragg peak.</span>
<span class="sd">    To avoid negative intensity after subtracting the background fit the minimum is set to zero.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scan_rocking : dictionary</span>
<span class="sd">        This dictionary contains the raw and analysed measurement data. This function uses</span>
<span class="sd">        the keys: &#39;unique_delays&#39;: measured different delays, &#39;qz_axis&#39;: relevant range in reciprocal space,</span>
<span class="sd">        &#39;intensity_rock&#39;: intensity for each delay and &#39;qz_axis&#39; loop-wise averaged.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scan_rocking : dictionary</span>
<span class="sd">        The function added the keys: &#39;intensity_peak&#39;: background-free time-dependent intensity</span>
<span class="sd">        of the Bragg peak, &#39;ref_fit&#39;: lm model object that contains the peak properties before</span>
<span class="sd">        excitation as reference for time-dependent fit.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Subtracting linear scattering background.&#39;</span><span class="p">)</span>
    <span class="n">intensity_t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scan_rocking</span><span class="p">[</span><span class="s1">&#39;intensity_rock&#39;</span><span class="p">][</span><span class="n">scan_rocking</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">com_t0</span><span class="p">,</span> <span class="n">std_t0</span><span class="p">,</span> <span class="n">integral_t0</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">calc_moments</span><span class="p">(</span><span class="n">scan_rocking</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">],</span> <span class="n">intensity_t0</span><span class="p">)</span>
    <span class="n">intensity_peak</span> <span class="o">=</span> <span class="n">scan_rocking</span><span class="p">[</span><span class="s1">&#39;intensity_rock&#39;</span><span class="p">]</span>
    <span class="n">ref_fit</span> <span class="o">=</span> <span class="n">gaussian_back_fit</span><span class="p">(</span><span class="n">com_t0</span><span class="p">,</span> <span class="n">std_t0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">intensity_t0</span><span class="p">),</span>
                                <span class="n">scan_rocking</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">],</span> <span class="n">intensity_t0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">scan_rocking</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">])):</span>
        <span class="n">intensity_peak</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">scan_rocking</span><span class="p">[</span><span class="s1">&#39;intensity_rock&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> \
            <span class="p">(</span><span class="n">scan_rocking</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">ref_fit</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">ref_fit</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;intercept&quot;</span><span class="p">])</span>
        <span class="n">intensity_peak</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">intensity_peak</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">intensity_peak</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">scan_rocking</span><span class="p">[</span><span class="s1">&#39;intensity_peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensity_peak</span>
    <span class="n">scan_rocking</span><span class="p">[</span><span class="s1">&#39;ref_fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_fit</span>
    <span class="k">return</span> <span class="n">scan_rocking</span></div>


<div class="viewcode-block" id="get_peak_dynamics"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.get_peak_dynamics">[docs]</a><span class="k">def</span> <span class="nf">get_peak_dynamics</span><span class="p">(</span><span class="n">scan_back</span><span class="p">,</span> <span class="n">export</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function uses the extracted intensity distribution along qz associated with the Bragg</span>
<span class="sd">    peak to determine its time-dependent position, width and amplitude using a fit and a center-of-mass</span>
<span class="sd">    analysis. Finally, the transient relative change in respect to the averaged value before excitation</span>
<span class="sd">    is determined and exportedto a folder &#39;exportedResults&#39;. The key &#39;com_border&#39; of teh dictionary &#39;scan_back&#39;</span>
<span class="sd">    provides the option to narrow the evaluted qz-range for the center-of-mass analysis. The key &#39;bool_plot_fit&#39;</span>
<span class="sd">    of the dictionary &#39;export&#39; enables plotting the comparison of teh Bragg peak fit and the actual rocking curve.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scan_back : dictionary</span>
<span class="sd">        This dictionary contains the time-dependent intensity distribution along qz associated</span>
<span class="sd">        with the Bragg peak. This function uses the keys: &#39;unique_delays&#39;: measured different delays,</span>
<span class="sd">        &#39;qz_axis&#39;: relevant range along qz containing the Bragg peak, &#39;com_border&#39;: lower and upper border</span>
<span class="sd">        along qz for center-of-mass evaluation (default: full &#39;qz_axis&#39; range), &#39;intensity_peak&#39;: background-</span>
<span class="sd">        free time-dependent intensity of the Bragg peak, &#39;ref_fit&#39;: lm model object that contains the peak</span>
<span class="sd">        properties before excitation as reference for time-dependent fit, &#39;temperature&#39;: temperature of the</span>
<span class="sd">        measurement in [K] and &#39;fluence&#39;: excitation fluence in [mJ/cm2].</span>
<span class="sd">    export : dictionary</span>
<span class="sd">        This dictionary contains the parameters to plot and export the calculated results. This</span>
<span class="sd">        function uses the keys: &#39;bool_plot_fit&#39;: whether or not the time-dependent fit of the</span>
<span class="sd">        rocking curve is plotted (default: False).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scan_back : dictionary</span>
<span class="sd">        The function added the key: &#39;com&#39;: time-dependent position, &#39;std&#39;: time-dependent width,</span>
<span class="sd">        &#39;integral&#39;: time-dependent amplitude, &#39;center_fit&#39;: time-dependent position, &#39;width_fit&#39;:</span>
<span class="sd">        time-dependent width, &#39;area_fit&#39;: time-dependent amplitude, &#39;transient_results&#39;: two-dimensional</span>
<span class="sd">        array that contains the relative change of the peak properties for both evaluations for each</span>
<span class="sd">        different measured delay.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">com</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]))</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]))</span>
    <span class="n">integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]))</span>
    <span class="n">center_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]))</span>
    <span class="n">width_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]))</span>
    <span class="n">area_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">])):</span>
        <span class="k">if</span> <span class="s1">&#39;com_border&#39;</span> <span class="ow">in</span> <span class="n">scan_back</span><span class="p">:</span>
            <span class="n">s_com_qz</span> <span class="o">=</span> <span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;com_border&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;com_border&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">com</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">std</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">integral</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">calc_moments</span><span class="p">(</span>
                <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">][</span><span class="n">s_com_qz</span><span class="p">],</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;intensity_peak&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">s_com_qz</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">com</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">std</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">integral</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">calc_moments</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">],</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;intensity_peak&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="n">gaussian_fit</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;ref_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;g_center&quot;</span><span class="p">],</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;ref_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;g_sigma&quot;</span><span class="p">],</span>
                           <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;ref_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;g_amplitude&quot;</span><span class="p">],</span>
                           <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">],</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;intensity_peak&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">center_fit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;g_center&quot;</span><span class="p">]</span>
        <span class="n">width_fit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;g_sigma&quot;</span><span class="p">]</span>
        <span class="n">area_fit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;g_amplitude&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;bool_plot_fit&#39;</span><span class="p">]:</span>
            <span class="n">plot_peak_fit</span><span class="p">(</span><span class="n">export</span><span class="p">,</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">],</span> <span class="n">fit</span><span class="p">,</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;ref_fit&#39;</span><span class="p">],</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

    <span class="n">s_before_t0</span> <span class="o">=</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="n">com_relative</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">tools</span><span class="o">.</span><span class="n">rel_change</span><span class="p">(</span><span class="n">com</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">com</span><span class="p">[</span><span class="n">s_before_t0</span><span class="p">]))</span>
    <span class="n">std_relative</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">rel_change</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">std</span><span class="p">[</span><span class="n">s_before_t0</span><span class="p">]))</span>
    <span class="n">integral_relative</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">rel_change</span><span class="p">(</span><span class="n">integral</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">integral</span><span class="p">[</span><span class="n">s_before_t0</span><span class="p">]))</span>
    <span class="n">center_relative</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">tools</span><span class="o">.</span><span class="n">rel_change</span><span class="p">(</span><span class="n">center_fit</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">center_fit</span><span class="p">[</span><span class="n">s_before_t0</span><span class="p">]))</span>
    <span class="n">width_relative</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">rel_change</span><span class="p">(</span><span class="n">width_fit</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">width_fit</span><span class="p">[</span><span class="n">s_before_t0</span><span class="p">]))</span>
    <span class="n">area_relative</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">rel_change</span><span class="p">(</span><span class="n">area_fit</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">area_fit</span><span class="p">[</span><span class="n">s_before_t0</span><span class="p">]))</span>

    <span class="n">transient_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]),</span> <span class="mi">9</span><span class="p">))</span>
    <span class="n">transient_results</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]))</span>
    <span class="n">transient_results</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;fluence&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]))</span>
    <span class="n">transient_results</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span>
    <span class="n">transient_results</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">com_relative</span>
    <span class="n">transient_results</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e2</span><span class="o">*</span><span class="n">std_relative</span>
    <span class="n">transient_results</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e2</span><span class="o">*</span><span class="n">integral_relative</span>
    <span class="n">transient_results</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">center_relative</span>
    <span class="n">transient_results</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e2</span><span class="o">*</span><span class="n">width_relative</span>
    <span class="n">transient_results</span><span class="p">[:,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e2</span><span class="o">*</span><span class="n">area_relative</span>

    <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;com&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">com</span>
    <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span>
    <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;integral&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">integral</span>
    <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;center_fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">center_fit</span>
    <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;width_fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">width_fit</span>
    <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;area_fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_fit</span>
    <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transient_results</span>

    <span class="n">tools</span><span class="o">.</span><span class="n">make_folder</span><span class="p">(</span><span class="s1">&#39;exportedResults&#39;</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">write_list_to_file</span><span class="p">(</span><span class="s1">&#39;exportedResults/&#39;</span> <span class="o">+</span> <span class="n">scan_back</span><span class="p">[</span><span class="s1">&#39;identifier&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.dat&#39;</span><span class="p">,</span> <span class="s1">&#39;0T(K)  1F(mJ/cm)  &#39;</span>
                             <span class="o">+</span> <span class="s1">&#39;2delay(ps)  3strainCOM(permille)  4STDrelative(%)  5Integralrelative(%)  &#39;</span>
                             <span class="o">+</span> <span class="s1">&#39;6strainFit(permille)  7widthFit(%)  8areaFit(%)&#39;</span><span class="p">,</span> <span class="n">transient_results</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scan_back</span></div>


<span class="c1"># %%</span>
<span class="sd">&#39;&#39;&#39;------------------------------------------------</span>
<span class="sd">   Functions specialised on rss experimental scheme</span>
<span class="sd">   ------------------------------------------------&#39;&#39;&#39;</span>

<span class="c1"># %%</span>


<div class="viewcode-block" id="read_data_rss"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.read_data_rss">[docs]</a><span class="k">def</span> <span class="nf">read_data_rss</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">export</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function reads in the raw data (intensity per pixel and omega angle) and</span>
<span class="sd">    adds it to the dictionary &#39;scan&#39;. This dictionary contains the corresponding</span>
<span class="sd">    measurement parameters added by &#39;get_scan_parameter&#39; and the evaluation parameters</span>
<span class="sd">    added in the main script. From the raw data the function exclude bad loops and pixels</span>
<span class="sd">    given by the keys &#39;bad_loops&#39; and &#39;bad_pixels&#39; of &#39;scan&#39; and normalize the intensity</span>
<span class="sd">    on the crystal voltage using the key &#39;crystal_offset&#39;. Scan with an intensity below</span>
<span class="sd">    &#39;crystal_threshold&#39; are excluded. By the keysof the dictionary &#39;export &#39;raw_data_path&#39;</span>
<span class="sd">    and &#39;bool_refresh_data&#39; you can refresh the data from the data path of the raw data</span>
<span class="sd">    during measurement.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scan : dictionary</span>
<span class="sd">        This dictionary contains the parameters from the reference file. This function uses</span>
<span class="sd">        the keys: &#39;number&#39;: row of refernece file, &#39;date&#39;: date of measurement, &#39;time&#39;:</span>
<span class="sd">        time of measurement, &#39;temperature&#39;: temperature in [K], &#39;fluence&#39;: excitation fluence</span>
<span class="sd">        in [mJ/cm2], &#39;crystal_offset&#39;: offset of teh reference diode in [V], &#39;crystal_threshold&#39;:</span>
<span class="sd">        minimum intensity not excluded in [V], &#39;bad_loops&#39;: loops to excluded (default: []),</span>
<span class="sd">        &#39;bad_pixels&#39;: pixels to exclude (default: []), &#39;time_zero&#39;: delay of pump-probe overlap</span>
<span class="sd">        in [ps] (default: 0.0).</span>
<span class="sd">    export : dictionary</span>
<span class="sd">        This dictionary contains the parameters to plot and export the calculated results. This</span>
<span class="sd">        function uses the keys: &#39;bool_refresh_data&#39;: whether or not the raw data should be updated</span>
<span class="sd">        during measurement (default: False), &#39;raw_data_path&#39;: the corresponding path to the measurement</span>
<span class="sd">        folder (default: &#39;test/test2/test3/&#39;), &#39;save_path&#39;: path to the folder to finally save the data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scan : dictionary</span>
<span class="sd">        The function added the keys: &#39;pixel_axis&#39;: array of the pixel numbers of the detector, &#39;delays&#39;:</span>
<span class="sd">        all delays including several loops, &#39;unique_delays&#39;: different measured delays, &#39;intensity&#39;:</span>
<span class="sd">        on reference diode voltage normalized intensity per non-excluded pixel and all delays and</span>
<span class="sd">        non-excluded loops, &#39;omega_deg&#39;: incident x-ray angle in [deg], &#39;omega_rad&#39;: incident x-ray</span>
<span class="sd">        angle in [rad].</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;bool_refresh_data&#39;</span> <span class="ow">in</span> <span class="n">export</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;bool_refresh_data&#39;</span><span class="p">]:</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">make_folder</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">])</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;raw_data_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/parameters&#39;</span> <span class="o">+</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">+</span>
                            <span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/parameters&#39;</span> <span class="o">+</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;raw_data_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/scans&#39;</span> <span class="o">+</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">+</span>
                            <span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/scans&#39;</span> <span class="o">+</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;refreshing data from&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;raw_data_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; ...&#39;</span><span class="p">)</span>

    <span class="n">data_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/scans&#39;</span> <span class="o">+</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.dat&#39;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Evaluating measurement: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span> <span class="o">+</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">+</span>
          <span class="s1">&#39; | &#39;</span> <span class="o">+</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;K&#39;</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="s1">&#39;fluence&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;mJ/cm2&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Based on crystal threshold &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">data_raw</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;crystal_offset&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;crystal_threshold&#39;</span><span class="p">]))</span>
          <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_raw</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39; scans are excluded.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
    <span class="n">data_raw</span> <span class="o">=</span> <span class="n">data_raw</span><span class="p">[</span><span class="n">data_raw</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;crystal_offset&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;crystal_threshold&#39;</span><span class="p">],</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="s1">&#39;bad_loops&#39;</span> <span class="ow">in</span> <span class="n">scan</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Excluded loops from the measurement:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="s1">&#39;bad_loops&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="s1">&#39;bad_loops&#39;</span><span class="p">])):</span>
            <span class="n">data_raw</span> <span class="o">=</span> <span class="n">data_raw</span><span class="p">[</span><span class="n">data_raw</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;bad_loops&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span> <span class="p">:]</span>
    <span class="k">if</span> <span class="s1">&#39;bad_pixels&#39;</span> <span class="ow">in</span> <span class="n">scan</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Excluded pixels from the measurement:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="s1">&#39;bad_pixels&#39;</span><span class="p">]))</span>
        <span class="n">mask_bad_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>
        <span class="k">for</span> <span class="n">bp</span> <span class="ow">in</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;bad_pixels&#39;</span><span class="p">]:</span>
            <span class="n">mask_bad_pixels</span><span class="p">[</span><span class="n">bp</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">data_raw</span> <span class="o">=</span> <span class="n">data_raw</span><span class="p">[:,</span> <span class="n">mask_bad_pixels</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;time_zero&#39;</span> <span class="ow">in</span> <span class="n">scan</span><span class="p">:</span>
        <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;delays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_raw</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;time_zero&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;delays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_raw</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">0</span>

    <span class="n">crystal_v</span> <span class="o">=</span> <span class="n">data_raw</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;crystal_offset&#39;</span><span class="p">]</span>
    <span class="n">intensity</span> <span class="o">=</span> <span class="n">data_raw</span><span class="p">[:,</span> <span class="mi">9</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="s1">&#39;delays&#39;</span><span class="p">])):</span>
        <span class="n">intensity</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data_raw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">9</span><span class="p">:]</span><span class="o">/</span><span class="n">crystal_v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;pixel_axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">intensity</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="s1">&#39;delays&#39;</span><span class="p">])</span>
    <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensity</span>
    <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;omega_deg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data_raw</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">scan</span><span class="p">[</span><span class="s1">&#39;omega_rad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="s1">&#39;omega_deg&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">scan</span></div>


<div class="viewcode-block" id="get_rocking_rss"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.get_rocking_rss">[docs]</a><span class="k">def</span> <span class="nf">get_rocking_rss</span><span class="p">(</span><span class="n">scan_raw</span><span class="p">,</span> <span class="n">export</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function calculates the intensity distribution along qz from an intensity</span>
<span class="sd">    as function of the detector pixel for a certain incident x-ray angle. The resulting</span>
<span class="sd">    loop-wise averaged rocking curve as function of the pump-probe delay is appended to</span>
<span class="sd">    the dictionary and saved in the respective folder structure. By the key &#39;qz_border&#39;</span>
<span class="sd">    of &#39;scan_raw&#39; you can choose a certain range in reciprocal space that contains the</span>
<span class="sd">    relevant Bragg peak (default: full covered qz range).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scan_raw : dictionary</span>
<span class="sd">        This dictionary contains the parameters of the measurement as well as the x-ray</span>
<span class="sd">        intensity as function of pump-probe delay and detector pixel. This function uses</span>
<span class="sd">        the keys: &#39;omge_rad&#39;: incident x-ray angle in [rad], &#39;distance&#39;: distance between</span>
<span class="sd">        sample and detector in [m], &#39;pixel_axis&#39;: array of the pixel numbers of the detector,</span>
<span class="sd">        &#39;centerpixel&#39;: pixel where incident equal to diffraction angle is fullfilled (default:</span>
<span class="sd">        244), &#39;qz_border&#39;: lower and upper border of teh relevant qz range (default: full</span>
<span class="sd">        covered qz range), &#39;delays&#39;: all delays including several loops, &#39;unique_delays&#39;:</span>
<span class="sd">        different measured delays and &#39;intensity&#39;: on reference diode voltage normalized intensity</span>
<span class="sd">        per non-excluded pixel and all delays and non-excluded loops.</span>
<span class="sd">    export : dictionary</span>
<span class="sd">        This dictionary contains the parameters to plot and export the calculated results. This</span>
<span class="sd">        function uses the keys: &#39;save_path&#39;: path to the folder to finally save the data and</span>
<span class="sd">        &#39;file_name&#39;: name of teh saved data given by a combination of date and time of the</span>
<span class="sd">        measurement.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scan_raw : dictionary</span>
<span class="sd">        The function added the keys: &#39;theta_axis&#39;: corresponding diffraction angles of the detector</span>
<span class="sd">        pixels in [rad] given by &#39;omega_rad&#39; and &#39;distance&#39;, &#39;qx_axis&#39;: values of the detector pixels</span>
<span class="sd">        along qx given by &#39;theta_axis&#39;, &#39;qz_axis&#39;: values of the detector pixels along qz given by</span>
<span class="sd">        &#39;theta_axis&#39; and limited by &#39;qz_border&#39;, &#39;intensity_rock&#39;: loop-wise averaged intensity as</span>
<span class="sd">        function of &#39;unique_delays&#39; and the choosen range in qz &#39;qz_axis&#39;.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculating rocking curve.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;centerpixel&#39;</span> <span class="ow">in</span> <span class="n">scan_raw</span><span class="p">:</span>
        <span class="n">theta_axis</span> <span class="o">=</span> <span class="n">calc_theta_value</span><span class="p">(</span><span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;omega_rad&#39;</span><span class="p">],</span> <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span>
                                      <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;pixel_axis&#39;</span><span class="p">],</span> <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;centerpixel&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">theta_axis</span> <span class="o">=</span> <span class="n">calc_theta_value</span><span class="p">(</span><span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;omega_rad&#39;</span><span class="p">],</span> <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span>
                                      <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;pixel_axis&#39;</span><span class="p">],</span> <span class="mi">244</span><span class="p">)</span>

    <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;qx_axis&#39;</span><span class="p">],</span> <span class="n">qz_axis</span> <span class="o">=</span> <span class="n">calc_qx_qz</span><span class="p">(</span><span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;omega_rad&#39;</span><span class="p">],</span> <span class="n">theta_axis</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;qz_border&#39;</span> <span class="ow">in</span> <span class="n">scan_raw</span><span class="p">:</span>
        <span class="n">s_qz_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">qz_axis</span> <span class="o">&gt;=</span> <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;qz_border&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">qz_axis</span> <span class="o">&lt;=</span> <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;qz_border&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qz_axis</span><span class="p">[</span><span class="n">s_qz_range</span><span class="p">]</span>
        <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;theta_axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_axis</span><span class="p">[</span><span class="n">s_qz_range</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qz_axis</span>
        <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;theta_axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_axis</span>

    <span class="n">rocking</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">rocking</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">8000</span><span class="p">],</span> <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">])</span>
    <span class="n">rocking</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">8000</span><span class="p">],</span> <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;theta_axis&#39;</span><span class="p">])</span>
    <span class="n">rocking</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">8000</span><span class="p">,</span> <span class="o">-</span><span class="mi">8000</span><span class="p">],</span> <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">])</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]:</span>
        <span class="n">rocking</span><span class="p">[</span><span class="n">counter</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;delays&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span><span class="p">,</span> <span class="p">:][:,</span> <span class="n">s_qz_range</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">scan_raw</span><span class="p">[</span><span class="s1">&#39;intensity_rock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rocking</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exporting calculated rocking curves.&#39;</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">make_folder</span><span class="p">(</span><span class="s1">&#39;exportedRockingCurves&#39;</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">write_list_to_file</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/rockingCurves&#39;</span>
                             <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.dat&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;column 1: delays, row 1: qz, row 2: theta&#39;</span><span class="p">,</span> <span class="n">rocking</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">write_list_to_file</span><span class="p">(</span><span class="s1">&#39;exportedRockingCurves/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.dat&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;column 1: delays, row 1: qz, row 2: theta&#39;</span><span class="p">,</span> <span class="n">rocking</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scan_raw</span></div>


<span class="c1"># %%</span>
<span class="sd">&#39;&#39;&#39;------------------------------------------</span>
<span class="sd">   Fit functions for evaluating rocking curve</span>
<span class="sd">   ------------------------------------------&#39;&#39;&#39;</span>

<span class="c1"># %%</span>


<div class="viewcode-block" id="gaussian_back_fit"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.gaussian_back_fit">[docs]</a><span class="k">def</span> <span class="nf">gaussian_back_fit</span><span class="p">(</span><span class="n">center_start</span><span class="p">,</span> <span class="n">sigma_start</span><span class="p">,</span> <span class="n">amplitude_start</span><span class="p">,</span> <span class="n">qz_axis</span><span class="p">,</span> <span class="n">intensity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function returns the fit parameters for a gaussian with linear background model</span>
<span class="sd">    as a lm model object for the &#39;intensity&#39; as function of &#39;qz_axis&#39;. The start values of</span>
<span class="sd">    &#39;slope&#39; and &#39;intercept&#39; are set to zero by default.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    center_start: float</span>
<span class="sd">            start value for the center of gaussian</span>
<span class="sd">    sigma_start: float</span>
<span class="sd">            start value for the width of gaussian</span>
<span class="sd">    amplitude_start: float</span>
<span class="sd">            start value for the amplitude of gaussian</span>
<span class="sd">    qz_axis: 1D array</span>
<span class="sd">            part of interest of reciprocal space</span>
<span class="sd">    intensity: 1D array</span>
<span class="sd">            part of interest of the detector intensities</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    fit: lm model objekt</span>
<span class="sd">            allows to get fit values (.values), the used data (.data), the initial fit (.init_fit)</span>
<span class="sd">            and the best fit (.best_fit) for the further analysis</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; 3.855 = gaussian_back_fit(3.85, 0.05, 100, qz, intensity)[&#39;g_center&#39;]&quot;&quot;&quot;</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">GaussianModel</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;g_&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">lm</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">LinearModel</span><span class="p">()</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">add_many</span><span class="p">((</span><span class="s1">&#39;g_center&#39;</span><span class="p">,</span> <span class="n">center_start</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;g_sigma&#39;</span><span class="p">,</span> <span class="n">sigma_start</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;g_amplitude&#39;</span><span class="p">,</span> <span class="n">amplitude_start</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;intercept&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">qz_axis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fit</span></div>


<div class="viewcode-block" id="gaussian_fit"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.gaussian_fit">[docs]</a><span class="k">def</span> <span class="nf">gaussian_fit</span><span class="p">(</span><span class="n">center_start</span><span class="p">,</span> <span class="n">sigma_start</span><span class="p">,</span> <span class="n">amplitude_start</span><span class="p">,</span> <span class="n">qz_axis</span><span class="p">,</span> <span class="n">intensity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function returns the fit parameters for a gaussian peak model as a lm</span>
<span class="sd">    model object for the &#39;intensity&#39; as function of &#39;qz_axis&#39;.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    center_start: float</span>
<span class="sd">            start value for the center of gaussian</span>
<span class="sd">    sigma_start: float</span>
<span class="sd">            start value for the width of gaussian</span>
<span class="sd">    amplitude_start: float</span>
<span class="sd">            start value for the amplitude of gaussian</span>
<span class="sd">    qz_axis: 1D array</span>
<span class="sd">            part of interest of reciprocal space</span>
<span class="sd">    intensity: 1D array</span>
<span class="sd">            part of interest of the detector intensities</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    fit: lm model objekt</span>
<span class="sd">            allows to get fit values (.values), the used data (.data), the initial fit (.init_fit)</span>
<span class="sd">            and the best fit (.best_fit) for the further analysis</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; 3.855 = gaussian_back_fit(3.85, 0.05, 100, qz, intensity)[&#39;g_center&#39;]&quot;&quot;&quot;</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">GaussianModel</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;g_&quot;</span><span class="p">)</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">add_many</span><span class="p">((</span><span class="s1">&#39;g_center&#39;</span><span class="p">,</span> <span class="n">center_start</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;g_sigma&#39;</span><span class="p">,</span> <span class="n">sigma_start</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;g_amplitude&#39;</span><span class="p">,</span> <span class="n">amplitude_start</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">qz_axis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fit</span></div>


<span class="c1"># %%</span>
<span class="sd">&#39;&#39;&#39;------------------------------------</span>
<span class="sd">   Figures evaluating the rocking curve</span>
<span class="sd">   ------------------------------------&#39;&#39;&#39;</span>

<span class="c1"># %%</span>


<div class="viewcode-block" id="plot_rocking_overview"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.plot_rocking_overview">[docs]</a><span class="k">def</span> <span class="nf">plot_rocking_overview</span><span class="p">(</span><span class="n">scan_rock</span><span class="p">,</span> <span class="n">export</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function generates an illustration of the transient loopwise-averaged</span>
<span class="sd">    intensity distribution along qz. The three-dimensional figure consists of two</span>
<span class="sd">    parts separated by an axes break to visualize both strain waves at small delays</span>
<span class="sd">    and heat transport for long delays.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scan_rock : dictionary</span>
<span class="sd">        This dictionary contains the measurmeent parameters as well as the raw x-ray</span>
<span class="sd">        data and the calculated intensity distribution along qz. This function uses the</span>
<span class="sd">        keys: &#39;unique_delays&#39;: measured delays, &#39;qz_axis&#39;: part of reciprocal space given</span>
<span class="sd">        by key &#39;qz_range&#39;, &#39;intensity_rock&#39;: loop-wise averaged intensity of transient</span>
<span class="sd">        rocking curves.</span>
<span class="sd">    export : dictionary</span>
<span class="sd">        This dictionary contains the parameters to plot and export the calculated results</span>
<span class="sd">        in &#39;scan_rock&#39;. This function uses the keys: &#39;bool_plot_2D_rocking_semilogy&#39;: whether</span>
<span class="sd">        the norm is logarithmic or linear, &#39;intensity_range_2D&#39;: list of intensity min and max</span>
<span class="sd">        for plotting range, &#39;delay_steps&#39;: list of xtick step first part, delay of axis break and</span>
<span class="sd">        xtick step second part, &#39;plot_title&#39;: main measurmeent parameter as title of the figure,</span>
<span class="sd">        &#39;save_path&#39;: location in the folder structure to save the figure.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plot time-resolved loopwise-averaged rocking curves.&#39;</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;bool_plot_2D_rocking_semilogy&#39;</span><span class="p">]:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;intensity_rock&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;intensity_rock&#39;</span><span class="p">])),</span>
                              <span class="n">norm</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span>
                <span class="n">vmin</span><span class="o">=</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;intensity_range_2D&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;intensity_range_2D&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color</span><span class="o">.</span><span class="n">cmap_blue_red_5</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;intensity_rock&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;intensity_rock&#39;</span><span class="p">])),</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;intensity_range_2D&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;intensity_range_2D&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color</span><span class="o">.</span><span class="n">cmap_blue_red_5</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
             <span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
             <span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;qz_axis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                   <span class="n">scan_rock</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;delay (ps)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_z$ ($\mathrm{\AA^{-1}}$)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

    <span class="n">cbaxes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.925</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.023</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">])</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbaxes</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;normed x-ray intensity&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">1.07</span><span class="p">,</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;plot_title&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">make_folder</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/exportedFigures&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/exportedFigures/rocking_curves_2D.png&#39;</span><span class="p">,</span>
                <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_peak_fit"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.plot_peak_fit">[docs]</a><span class="k">def</span> <span class="nf">plot_peak_fit</span><span class="p">(</span><span class="n">export</span><span class="p">,</span> <span class="n">qz_axis</span><span class="p">,</span> <span class="n">fit</span><span class="p">,</span> <span class="n">ref_fit</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function generates a comparison of the rocking curve (intensity(qz)) with</span>
<span class="sd">    the fit of the Bragg peak. The rocking curve and its fit at a certan delay is</span>
<span class="sd">    compared with the &#39;ref_fit&#39; of the averaged rocking curve before t0.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    export: dictionary</span>
<span class="sd">            This dictionary contains the parameters to plot and export. This function uses the keys:</span>
<span class="sd">            &#39;bool_plot_1D_rocking_semilogy&#39;: whether the norm is logarithmic or linear,</span>
<span class="sd">            &#39;intensity_range_1D&#39;: list of intensity min and max for plotting range, &#39;plot_title&#39;:</span>
<span class="sd">            main measurmeent parameter as title of the figure, &#39;save_path&#39;: location in the folder</span>
<span class="sd">            structure to save the figure.</span>
<span class="sd">    qz_axis: 1D array</span>
<span class="sd">            the relevant region in reciprocal space</span>
<span class="sd">    fit: lm model objekt</span>
<span class="sd">            allows to get fit values (.values), the used data (.data), the initial fit (.init_fit)</span>
<span class="sd">            and the best fit (.best_fit).</span>
<span class="sd">    ref_fit: lm model objekt</span>
<span class="sd">            allows to get fit values (.values), the used data (.data), the initial fit (.init_fit)</span>
<span class="sd">            and the best fit (.best_fit) for delays before exciation</span>
<span class="sd">    delay: float</span>
<span class="sd">            delay of the fitted rocking curve, used in the plot title</span>

<span class="sd">   Returns</span>
<span class="sd">   -------</span>
<span class="sd">   None.</span>

<span class="sd">   &#39;&#39;&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;bool_plot_1D_rocking_semilogy&#39;</span><span class="p">]:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">qz_axis</span><span class="p">,</span> <span class="n">fit</span><span class="o">.</span><span class="n">data</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">qz_axis</span><span class="p">,</span> <span class="n">ref_fit</span><span class="o">.</span><span class="n">best_fit</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fit t&lt;0&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">qz_axis</span><span class="p">,</span> <span class="n">fit</span><span class="o">.</span><span class="n">best_fit</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="o">.</span><span class="n">cmap_blue_red_5</span><span class="p">(</span><span class="mf">0.99</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;best fit&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qz_axis</span><span class="p">,</span> <span class="n">fit</span><span class="o">.</span><span class="n">data</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qz_axis</span><span class="p">,</span> <span class="n">ref_fit</span><span class="o">.</span><span class="n">best_fit</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fit t&lt;0&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qz_axis</span><span class="p">,</span> <span class="n">fit</span><span class="o">.</span><span class="n">best_fit</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="o">.</span><span class="n">cmap_blue_red_5</span><span class="p">(</span><span class="mf">0.99</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;best fit&quot;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$q_{\mathrm</span><span class="si">{z}</span><span class="s2">}$&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; ($\AA^{-1}$)&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot; norm x-ray intensity&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">qz_axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">qz_axis</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;intensity_range_1D&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;intensity_range_1D&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;ps | &#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;plot_title&#39;</span><span class="p">],</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">make_folder</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Fitgraphics&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Fitgraphics&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">delay</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;ps.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_transient_results"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.functions.plot_transient_results">[docs]</a><span class="k">def</span> <span class="nf">plot_transient_results</span><span class="p">(</span><span class="n">scan_results</span><span class="p">,</span> <span class="n">export</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function generates an illustration of the transient change of the Bragg</span>
<span class="sd">    peak properties by the fit and a center-of-mass analysis. The figure consists of</span>
<span class="sd">    three panels for teh transient relative change of the peak position along qz, its</span>
<span class="sd">    width and its amplitude. The delay axis consists of two parts separated by an axis</span>
<span class="sd">    break to visualize both strain waves at small delays and heat transport for long delays.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scan_results : dictionary</span>
<span class="sd">        This dictionary contains the measurmeent parameters as well as the transient properties</span>
<span class="sd">        of the measured Bragg peak and its relative change. This function uses the</span>
<span class="sd">        keys: &#39;unique_delays&#39;: measured delays and &#39;transient_results&#39;: two-dimensional array that</span>
<span class="sd">        contains the relative change of teh peak properties determined from a center-of-mass analysis</span>
<span class="sd">        and a fit.</span>
<span class="sd">    export : dictionary</span>
<span class="sd">        This dictionary contains the parameters to plot and export the calculated results</span>
<span class="sd">        in &#39;scan_results&#39;. This function uses the keys: &#39;delay_steps&#39;: list of xtick step first part,</span>
<span class="sd">        delay of axis break and xtick step second part, &#39;plot_title&#39;: main measurmeent parameter</span>
<span class="sd">        as title of the figure and &#39;save_path&#39;: location in the folder structure to save the figure.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">ax5</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">ax6</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;com&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;com&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                 <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                 <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;strain ($10^{-3}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;com&quot;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;com&quot;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                 <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                 <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;width change ($10^{-2}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;com&quot;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;com&quot;</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                 <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                 <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                                                                      <span class="o">-</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;transient_results&#39;</span><span class="p">][:,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;amplitude change ($10^{-2}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">ax5</span><span class="p">,</span> <span class="n">ax6</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax5</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                      <span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax2</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">ax6</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">export</span><span class="p">[</span><span class="s1">&#39;delay_steps&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;unique_delays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;pump-probe delay t (ps)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">1.16</span><span class="p">,</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;plot_title&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">export</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/OverviewResults.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
</pre></div>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Alexander von Reppert<br/>
  
      &copy; Copyright 2022, Alexander von Reppert.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>