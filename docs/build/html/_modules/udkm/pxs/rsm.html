<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>udkm.pxs.rsm &mdash; udkm 0.1</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> udkm
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/AleksUDKM/udkm">github project page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pxs.html">    pxs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../pxs.html#module-udkm.pxs.functions">functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pxs.html#module-udkm.pxs.rsm">rsm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pxs.html#module-udkm.pxs.rss">rss</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pxs.html#module-udkm.pxs.pxshelpers">pxshelpers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../moke.html">    moke</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools.html">    tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.html#module-udkm.tools.functions"><code class="docutils literal notranslate"><span class="pre">functions</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.html#module-udkm.tools.colors"><code class="docutils literal notranslate"><span class="pre">colors</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.html#module-udkm.tools.plot"><code class="docutils literal notranslate"><span class="pre">plot</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.html#module-udkm.tools.fit"><code class="docutils literal notranslate"><span class="pre">fit</span></code></a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">udkm</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>udkm.pxs.rsm</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for udkm.pxs.rsm</h1><div class="highlight"><pre>
<span></span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">udkm.tools.helpers</span> <span class="k">as</span> <span class="nn">h</span>

<span class="n">teststring</span> <span class="o">=</span> <span class="s2">&quot;Successfully loaded udkm.pxs.rsm&quot;</span>


<span class="c1">## detector related</span>
<span class="n">pixelsize</span>   <span class="o">=</span> <span class="mf">0.172</span><span class="o">*</span><span class="mf">1e-3</span> <span class="c1"># Detector pixelsize of the Pilatus in m</span>
<span class="n">centerpixel</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>       <span class="c1">#initializes the centerpixel with a negative value. Once it is set it stays the same</span>
<span class="n">detectorDistance</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>  <span class="c1">#initializes the sample detector distance  with a negative value. Once it is set it stays the same</span>

<span class="c1">## Normalization detector related</span>
<span class="n">crystalOffset</span> <span class="o">=</span> <span class="mf">0.0197</span>   <span class="c1">#Crystal Offset of the Crystal Normalization detector in [V]</span>
<span class="n">crystalThreshold</span> <span class="o">=</span> <span class="mf">0.003</span> <span class="c1">#Measurements where the Crystal Voltage is below this Value are discarded</span>
        
<span class="c1">## Source related</span>
<span class="n">wl</span>      <span class="o">=</span> <span class="mf">1.5418</span>           <span class="c1">#Cu K-alpha Wavelength in Angstroem</span>
<span class="n">k</span>       <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">wl</span>  <span class="c1">#absolute value of the incident k-vector in [1/Ang]</span>
<span class="n">convergenceXRays</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span> <span class="c1">#Convergence of the Optics used in our Plasma X-Ray source setup in [rad]      </span>
        
<span class="c1">## Calculation Related</span>
<span class="n">existsRefList</span>   <span class="o">=</span> <span class="kc">False</span>
<span class="n">existsPathList</span>  <span class="o">=</span> <span class="kc">False</span>
<span class="n">qzBGcalculated</span>  <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="loadParameters"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.loadParameters">[docs]</a><span class="k">def</span> <span class="nf">loadParameters</span><span class="p">(</span><span class="n">sampleName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Load the Parameter list into the object. Oversamplingz is the factor </span>
<span class="sd">    that tells how many times the number of omega datapoints are used to sample the qz-Axis. Usually oversamplingx</span>
<span class="sd">    should be set to the same value as oversamplingz. 1/oversamplingx is the factor by which the qx axis stepnumber</span>
<span class="sd">    is multiplied&quot;&quot;&quot;</span>
    <span class="n">sampleName</span> <span class="o">=</span> <span class="n">sampleName</span>        
    <span class="n">parameterListFileName</span> <span class="o">=</span> <span class="s1">&#39;ReferenceData/ParameterStatic&#39;</span> <span class="o">+</span> <span class="n">sampleName</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>          <span class="c1"># File Name of the Parameter File</span>
    <span class="n">paramList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">parameterListFileName</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">comments</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span>    <span class="c1"># Loading the Parameter File</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paramList</span><span class="p">)</span>       <span class="c1"># Number of Measurements   </span>
    <span class="n">IDs</span>  <span class="o">=</span> <span class="n">paramList</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>              
    <span class="n">date</span> <span class="o">=</span> <span class="n">paramList</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>         <span class="c1"># Date of the measurement</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">paramList</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>         <span class="c1"># Time of the measurement</span>
    <span class="n">TA</span> <span class="o">=</span> <span class="mi">300</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paramList</span><span class="p">))</span>          <span class="c1"># Temperature read from sensor A near the expander             </span>
    <span class="n">TB</span> <span class="o">=</span> <span class="mi">300</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paramList</span><span class="p">))</span>           <span class="c1"># Temperature read from sensor B near the sample</span>
    <span class="n">F</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>          <span class="c1"># Excitation Fluence here initializied as 0</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>  <span class="c1"># Delay of the Rocking curve here initialized as nan</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">timeStamp</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="n">time</span><span class="p">)</span> <span class="c1"># Unique Identifier of each measurement as seconds since 1970</span></div>
    
    
<div class="viewcode-block" id="ReadParameter"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.ReadParameter">[docs]</a><span class="k">def</span> <span class="nf">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function returns the parameters of the &#39;number&#39;. measuerement saved</span>
<span class="sd">    in the reference file &#39;Reference&#39;sample_name&#39;&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    sample_name: string </span>
<span class="sd">            name of the measured sample (named reference file)</span>
<span class="sd">    number: integer</span>
<span class="sd">            line in the reference datafile wich corresponds to the measurement</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    identifier: integer</span>
<span class="sd">            with timestemp from datetime extracted identification of the measurement  </span>
<span class="sd">    date: string</span>
<span class="sd">            date of the measurement extracted from the reference datafile</span>
<span class="sd">    time: string</span>
<span class="sd">            time of the measurement extracted from the reference datafile</span>
<span class="sd">    temperature: float</span>
<span class="sd">            temperature during the choosen measurement [K]</span>
<span class="sd">    fluence: float</span>
<span class="sd">            fluence during the choosen measurement [mJ/cm^2]</span>
<span class="sd">    distance: float</span>
<span class="sd">            distance between sample and detector for choosen measurement [m]</span>
<span class="sd">    </span>
<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt;  20191111 = readParameter(&#39;SRO&#39;,0)[1]&quot;&quot;&quot;</span>
    
    <span class="n">paramList</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ReferenceData/Measurements&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sample_name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.dat&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span>
    <span class="n">date</span>        <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">paramList</span><span class="p">[</span><span class="n">number</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">date</span>        <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">date</span>
    <span class="n">time</span>        <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">paramList</span><span class="p">[</span><span class="n">number</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">time</span>        <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">time</span>
    <span class="n">identifier</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">timeStamp</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="n">time</span><span class="p">))</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="n">paramList</span><span class="p">[</span><span class="n">number</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">fluence</span>     <span class="o">=</span> <span class="n">paramList</span><span class="p">[</span><span class="n">number</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">distance</span>    <span class="o">=</span> <span class="n">paramList</span><span class="p">[</span><span class="n">number</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> 
    <span class="k">return</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">fluence</span><span class="p">,</span> <span class="n">distance</span></div>

<div class="viewcode-block" id="GetLabel"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.GetLabel">[docs]</a><span class="k">def</span> <span class="nf">GetLabel</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function returns the title for plotting the result, the saving path</span>
<span class="sd">    and saving name of the data and plots. Therfore the function &#39;ReadParameter&#39; is used.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    sample_name: string </span>
<span class="sd">            name of the measured sample (named reference file)</span>
<span class="sd">    number: integer</span>
<span class="sd">            line in the reference datafile wich corresponds to the measurement</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    plot_title: string</span>
<span class="sd">            contains the &#39;sampleName&#39;, &#39;number&#39; of measurement, &#39;date&#39;, &#39;time&#39;,</span>
<span class="sd">            &#39;temperature&#39; and &#39;fluence&#39; of the choosen measurement</span>
<span class="sd">    save_path: string</span>
<span class="sd">            contains the &#39;date&#39; and &#39;time&#39; of the choosen measurement as an folder</span>
<span class="sd">            structure to define a saving path like the folder structure in the </span>
<span class="sd">            saved raw data</span>
<span class="sd">    date_file_name: string</span>
<span class="sd">            contains the &#39;date&#39; and &#39;time&#39; of the choosen measurement to give</span>
<span class="sd">            saved figures and data a usefull name</span>
<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; &#39;20181212/235959&#39; = GetLabel(&#39;Dataset&#39;,0)[1]</span>
<span class="sd">    &gt;&gt;&gt; &#39;20181212235959&#39; = GetLabel(&#39;Dataset&#39;,0)[2]&quot;&quot;&quot;</span>
    
    <span class="n">plot_title</span>     <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; | &#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">plot_title</span>     <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;K&#39;</span> <span class="o">+</span><span class="s1">&#39; | &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;mJ/cm2&#39;</span>
    <span class="n">save_path</span>      <span class="o">=</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">data_file_name</span> <span class="o">=</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">plot_title</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">data_file_name</span></div>

<div class="viewcode-block" id="SelectSingleRSM"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.SelectSingleRSM">[docs]</a><span class="k">def</span> <span class="nf">SelectSingleRSM</span><span class="p">(</span><span class="n">omega_loop_list</span><span class="p">,</span><span class="n">delay_loop_list</span><span class="p">,</span><span class="n">delay_list</span><span class="p">,</span><span class="n">omega_loop</span><span class="p">,</span><span class="n">delay_loop</span><span class="p">,</span><span class="n">delay</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function creates a boolean of the length of the three lists corresponding</span>
<span class="sd">    to the first columns of the measurement file from the same length, which give the </span>
<span class="sd">    RSM (intensity for every pixel and every measured omega angle) for a</span>
<span class="sd">    single omega loop, delay loop and delay.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    omega_loop_list: 1D array</span>
<span class="sd">        contains all measured omega loops with their measured delay loops and delays</span>
<span class="sd">    delay_loop_list: 1D array</span>
<span class="sd">        contains all measured delay loops for every omega loop with all delays</span>
<span class="sd">    delay_list: 1D array</span>
<span class="sd">        contains all delays measured for every omega and delay loop</span>
<span class="sd">    omega_loop: float</span>
<span class="sd">        the desired omega Loop</span>
<span class="sd">    delay_loop: float</span>
<span class="sd">        the desired delay Loop</span>
<span class="sd">    delay: float</span>
<span class="sd">        the desired delay</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    select: boolean</span>
<span class="sd">        True where omega loop AND delay loop AND delay is the desired value</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; SelectSingleRSM(np.array([1,1,1,1]),np.array([1,1,2,2]),np.array([0,5,5,0]),1,1,5)</span>
<span class="sd">    &gt;&gt;&gt; array([False,True,True,False])&quot;&quot;&quot;</span>

    <span class="n">s_omega_loop</span> <span class="o">=</span> <span class="n">omega_loop_list</span> <span class="o">==</span> <span class="n">omega_loop</span>
    <span class="n">s_delay_loop</span> <span class="o">=</span> <span class="n">delay_loop_list</span> <span class="o">==</span> <span class="n">delay_loop</span>
    <span class="n">s_delay</span>      <span class="o">=</span> <span class="n">delay_list</span> <span class="o">==</span> <span class="n">delay</span>
    <span class="n">select</span>       <span class="o">=</span> <span class="n">s_omega_loop</span> <span class="o">&amp;</span> <span class="n">s_delay_loop</span> <span class="o">&amp;</span> <span class="n">s_delay</span>
    <span class="k">return</span> <span class="n">select</span></div>

<div class="viewcode-block" id="LoadRSMTimeresolved"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.LoadRSMTimeresolved">[docs]</a><span class="k">def</span> <span class="nf">LoadRSMTimeresolved</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">crystal_offset</span><span class="p">,</span><span class="n">crystal_threshold</span><span class="p">,</span><span class="n">t0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function imports the raw RSMs from the measurement of the &#39;number&#39;. line</span>
<span class="sd">    of the reference file of the sample &#39;sampleName&#39; for the different omega loops, </span>
<span class="sd">    delay loops and delays. The first dimension of the RSM denotes the detector pixels</span>
<span class="sd">    and the second the omega angles. All angle measurements with a photon number below </span>
<span class="sd">    &#39;crystalThreshold&#39; + &#39;crystalOffset&#39; are replaced by the intensity of the last delay</span>
<span class="sd">    and the intensities are normed by the reduced crystal photon number. The RSMs for</span>
<span class="sd">    the different delays of the different loops are appended to a list of the structure</span>
<span class="sd">    &#39;fullRSMList[t][l][w]&#39;. Here, w denotes the omega loops, l the delay loops and t the delays.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    sample_name: string</span>
<span class="sd">        name of the measured sample (named reference file)</span>
<span class="sd">    number: integer</span>
<span class="sd">        line in the reference datafile wich corresponds to the measurement</span>
<span class="sd">    crystal_offset: float</span>
<span class="sd">        denotes the voltage of the crystal without xray photons</span>
<span class="sd">    crystal_threshold: float</span>
<span class="sd">        denotes a threshold, all mangle measurements with voltage below become excluded</span>
<span class="sd">    t0: float</span>
<span class="sd">        denotes the temporal overlapp of pump and probe of the experiment [ps]</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    RSM_list: list</span>
<span class="sd">        contains a list of RSMs with indizees: [omegaLoop][delayLoop][delay]</span>
<span class="sd">    unique_omega: 1D array</span>
<span class="sd">        contains the unique measured omgea angle values</span>
<span class="sd">    unique_delays: 1D array</span>
<span class="sd">        contains the unique measured pump-probe delays</span>
<span class="sd">    omega_loops: integer</span>
<span class="sd">        reterns the number of measured omega loops</span>
<span class="sd">    delay_loops: integer</span>
<span class="sd">        returns the number of measured delay loops</span>
<span class="sd">            </span>
<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; LoadRSMTimeresolved(&#39;SRO&#39;,17,0.017514,crystal_threshold,1)[0]</span>
<span class="sd">    &gt;&gt;&gt; [[[array([[50.2,51.2],[0,0.5],[0.2,0.9]]),array([[50.2,51.2],[0.2,0.5],[0.6,1.4]])]]]&quot;&quot;&quot;</span>
             
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading Data RSM: &#39;</span> <span class="o">+</span> <span class="n">sample_name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>    
    <span class="n">RSM_raw</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">GetLabel</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/scans&#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.dat&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span><span class="p">,</span><span class="n">delimiter</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">unique_delays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">RSM_raw</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span>
    <span class="n">unique_omega</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">RSM_raw</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">omega_loops</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_delays</span><span class="p">))</span>
    <span class="n">delay_loops</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_delays</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_delays</span><span class="p">)):</span>
        <span class="n">s_delay</span>        <span class="o">=</span> <span class="n">RSM_raw</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t0</span> <span class="o">==</span> <span class="n">unique_delays</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">omega_loops</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">RSM_raw</span><span class="p">[</span><span class="n">s_delay</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">delay_loops</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">RSM_raw</span><span class="p">[</span><span class="n">s_delay</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1">#sorting the entries of the raw RSM with crystal threshhold</span>
    <span class="n">s_photon_num</span> <span class="o">=</span> <span class="n">RSM_raw</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">crystal_offset</span> <span class="o">&gt;</span> <span class="n">crystal_threshold</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Above crystal threshhold: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">s_photon_num</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RSM_raw</span><span class="p">[:,</span><span class="mi">4</span><span class="p">])))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">RSM_raw</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])):</span>
        <span class="k">if</span> <span class="n">s_photon_num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">RSM_raw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">9</span><span class="p">:]</span> <span class="o">=</span> <span class="n">RSM_raw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">9</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_omega</span><span class="p">):</span>
                <span class="n">RSM_raw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">9</span><span class="p">:]</span> <span class="o">=</span> <span class="n">RSM_raw</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_omega</span><span class="p">),</span><span class="mi">9</span><span class="p">:]</span>
                <span class="n">RSM_raw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>  <span class="o">=</span> <span class="n">RSM_raw</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_omega</span><span class="p">),</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">RSM_raw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">9</span><span class="p">:]</span> <span class="o">=</span> <span class="n">RSM_raw</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_omega</span><span class="p">),</span><span class="mi">9</span><span class="p">:]</span>
    <span class="c1">#generate a list of the RSMs for each loop and delay for evaluation</span>
    <span class="n">RSM_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_delays</span><span class="p">)):</span>
        <span class="n">temp_list_delay</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">delay_loops</span><span class="p">[</span><span class="n">t</span><span class="p">])):</span>
            <span class="n">temp_list_loop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">omega_loops</span><span class="p">[</span><span class="n">t</span><span class="p">])):</span>
                <span class="n">RSM_angle</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">RSM_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">:]),</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">unique_omega</span><span class="p">)))</span>
                <span class="n">s_single_RSM</span> <span class="o">=</span> <span class="n">SelectSingleRSM</span><span class="p">(</span><span class="n">RSM_raw</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">RSM_raw</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">RSM_raw</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">w</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">unique_delays</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                <span class="n">single_RSM</span>   <span class="o">=</span> <span class="n">RSM_raw</span><span class="p">[</span><span class="n">s_single_RSM</span><span class="p">,:]</span>
                <span class="n">single_RSM</span>   <span class="o">=</span> <span class="n">single_RSM</span><span class="p">[</span><span class="n">single_RSM</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">(),:]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">single_RSM</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">RSM_angle</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_RSM</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">9</span><span class="p">:]</span>
                    <span class="n">RSM_angle</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">RSM_angle</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">single_RSM</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="n">crystalOffset</span><span class="p">)</span>
                <span class="n">temp_list_loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RSM_angle</span><span class="p">)</span>
            <span class="n">temp_list_delay</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_list_loop</span><span class="p">)</span>
        <span class="n">RSM_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_list_delay</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">RSM_list</span><span class="p">,</span> <span class="n">unique_omega</span><span class="p">,</span> <span class="n">unique_delays</span><span class="p">,</span> <span class="n">omega_loops</span><span class="p">,</span> <span class="n">delay_loops</span></div>

<div class="viewcode-block" id="PlotRSMRaw"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.PlotRSMRaw">[docs]</a><span class="k">def</span> <span class="nf">PlotRSMRaw</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">RSM_angle</span><span class="p">,</span><span class="n">unique_omega</span><span class="p">,</span><span class="n">log_plot</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function plotted a raw reciprocal space map, i.e. intensity for </span>
<span class="sd">    omega angles and detector pixels, whereby the intensity is plotted logarithmic.</span>
<span class="sd">    This plot of the &#39;RSM_raw&#39; can be saved in the data folder in &#39;Graphics&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    sample_name: string</span>
<span class="sd">        name of the measured sample (named reference file)</span>
<span class="sd">    number: integer</span>
<span class="sd">        line in the reference datafile wich corresponds to the measurement</span>
<span class="sd">    RSM_angle: 2D array</span>
<span class="sd">        contains the intensities for the measured omega angles (X) and the detector pixels (Y)</span>
<span class="sd">    unique_omega: 1D array</span>
<span class="sd">        ontains the unique measured omgea angle values for the x-axis o fthe plot</span>
<span class="sd">    log_plot: boolean</span>
<span class="sd">        set wether the intensity is plotted logarithmic or not</span>
<span class="sd">    </span>
<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; PlotRSMRaw(&#39;SRO&#39;,17,fullRSMList[0][0][0],np.array([50.2,51.2]),True)</span>
<span class="sd">    &gt;&gt;&gt; PlotRSMRaw(&#39;SRO&#39;,17,array([[50.2,51.2],[0,0.5],[0.2,0.9]]),np.array([50.2,51.2]),True)&quot;&quot;&quot;</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting RSM_angle&#39;</span><span class="p">)</span> 
    <span class="n">h</span><span class="o">.</span><span class="n">makeFolder</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">GetLabel</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/ExportedFigures&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>     
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">GetLabel</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">unique_omega</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">RSM_angle</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])))</span>
    <span class="k">if</span> <span class="n">log_plot</span><span class="p">:</span>
        <span class="n">plotted</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">RSM_angle</span><span class="o">/</span><span class="n">RSM_angle</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">norm</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rvb</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotted</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">RSM_angle</span><span class="o">/</span><span class="n">RSM_angle</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rvb</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="o">=</span><span class="n">plotted</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;omega (deg)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;pixels &#39;</span><span class="p">)</span>     
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">GetLabel</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/ExportedFigures/RSMAngle&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="calcCenterPixel"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.calcCenterPixel">[docs]</a><span class="k">def</span> <span class="nf">calcCenterPixel</span><span class="p">(</span><span class="n">RSM</span><span class="p">,</span><span class="n">center_pixel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function calculates the centerpixel of the measurement, but only if no positive value is manuell</span>
<span class="sd">    given. The centerpixel is given by the pixel with the maximum intensity as sum for all omega angles.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    RSM: 2D numpy array </span>
<span class="sd">        containing a distorted RSM</span>
<span class="sd">    center_pixel:  integer</span>
<span class="sd">        input centerpixel: If it is positive this is the return value otherwise the calculation starts</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    center_pixel: integer</span>
<span class="sd">        the pixel with the maximum intensity of the RSMraw or the used defined value</span>
<span class="sd">                    </span>
<span class="sd">    Example</span>
<span class="sd">    ------- </span>
<span class="sd">    &gt;&gt;&gt; 1 = calcCenterPixel(array([[10,11],[1,2],[5,10],[3,4]]),-1)&quot;&quot;&quot;</span>
            
    <span class="k">if</span> <span class="n">center_pixel</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">center_pixel</span> <span class="o">=</span> <span class="n">center_pixel</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">center_pixel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RSM</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>        
    <span class="k">return</span> <span class="n">center_pixel</span></div>

<div class="viewcode-block" id="calcQzQx"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.calcQzQx">[docs]</a><span class="k">def</span> <span class="nf">calcQzQx</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculates the corresponding values qx and qz for a diffraction geometry of omega, theta and k with qz in out-of-plane direction. </span>
<span class="sd">    The calculation is based on equation (4) of  Ultrafast reciprocal-space mapping with a convergent beam , 2013, Journal of Applied Crystallography, 46, 5, 1372-1377. </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    omega: float </span>
<span class="sd">        incident angle of the X-rays</span>
<span class="sd">    theta:  float</span>
<span class="sd">        diffraction angle to the detector</span>
<span class="sd">    k: float</span>
<span class="sd">        wave vector of the X-rays</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    qz : float</span>
<span class="sd">        the corrsponding qz coordinate in reciprocal space</span>
<span class="sd">    qx : float</span>
<span class="sd">        the corrsponding qx coordinate in reciprocal space</span>
<span class="sd">                    </span>
<span class="sd">    Example</span>
<span class="sd">    ------- </span>
<span class="sd">    &gt;&gt;&gt; 6.34, 0 = calcQzQx(51,51,4.075)&quot;&quot;&quot;</span>
        
    <span class="n">qx</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span>
    <span class="n">qz</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">qz</span><span class="p">,</span><span class="n">qx</span></div>

<div class="viewcode-block" id="CalcRSMQList"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.CalcRSMQList">[docs]</a><span class="k">def</span> <span class="nf">CalcRSMQList</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">RSM_angle</span><span class="p">,</span><span class="n">unique_omega</span><span class="p">,</span><span class="n">distance</span><span class="p">,</span><span class="n">pixel_size</span><span class="p">,</span><span class="n">center_pixel</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">convergence_XRays</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function calculates the transformation of teh Raw RSM to reciprocal</span>
<span class="sd">    space qx-qz. The detector pixels relative to the center pixel are associated</span>
<span class="sd">    with a different diffraction angle theta according to the pixel size and the</span>
<span class="sd">    sample-detector distance. The intensity at a pixel and an omega angle is normed</span>
<span class="sd">    by the area in angle space given by delta theta and convergence of the X-rays.</span>
<span class="sd">    After the transformation in qx-qz space the intensity density is normed by the</span>
<span class="sd">    Jacobian matrix of the transformation.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sample_name: string</span>
<span class="sd">        name of the measured sample (named reference file)</span>
<span class="sd">    number: integer</span>
<span class="sd">        line in the reference datafile wich corresponds to the measurement</span>
<span class="sd">    RSM_angle: 2D numpy array </span>
<span class="sd">        contains the crystal normalized intensity for pixels and omega angles</span>
<span class="sd">    unique_omega: 1D numpy array </span>
<span class="sd">        contains the measured omega angle steps</span>
<span class="sd">    distance: float</span>
<span class="sd">        distance between sample and detector [m]</span>
<span class="sd">    pixel_size: float</span>
<span class="sd">        dimension of the detector pixels in real space [m]</span>
<span class="sd">    center_pixel:  integer</span>
<span class="sd">        input centerpixel: If it is positive this is the return value </span>
<span class="sd">        otherwise the calculation starts</span>
<span class="sd">    k: float</span>
<span class="sd">        wave vector of the X-rays</span>
<span class="sd">    convergence_XRays: float</span>
<span class="sd">        convergence angle of incident X-rays [rad]</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    RSMQ_list: array</span>
<span class="sd">        contains the normed intensity distribution in q-space iterating the pixels</span>
<span class="sd">        for each unique omega resulting in len(unique_omega)*pixel num lines. </span>
<span class="sd">        Additionally, it contains angle informations and the jacobian matrix</span>
<span class="sd">        </span>
<span class="sd">    delta_theta:  float</span>
<span class="sd">        describes the angle space due to the real space dimension of the pixels [rad]&quot;&quot;&quot;</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculating RSMQ_list: &#39;</span> <span class="o">+</span> <span class="n">sample_name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">delta_theta</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">pixel_size</span><span class="o">/</span><span class="n">distance</span><span class="p">)</span>
    <span class="n">pixels</span>          <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RSM_angle</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">center_pixel</span>    <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">calcCenterPixel</span><span class="p">(</span><span class="n">RSM_angle</span><span class="p">,</span><span class="n">center_pixel</span><span class="p">)</span>
    <span class="n">RSMQ_list</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">RSM_angle</span><span class="p">),</span><span class="mi">13</span><span class="p">))</span>
    <span class="n">_</span><span class="p">,</span><span class="n">omegaL</span><span class="p">,</span><span class="n">omegaR</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">calcGridBoxes</span><span class="p">(</span><span class="n">unique_omega</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqueOmega</span><span class="p">))):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pixels</span><span class="p">:</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">n</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="n">i</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>  <span class="o">=</span> <span class="n">p</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>  <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">unique_omega</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>  <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">omegaL</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>  <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">omegaR</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>  <span class="o">=</span> <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta_theta</span><span class="o">*</span><span class="p">(</span><span class="n">pixels</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_pixel</span><span class="p">)</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">calcQzQx</span><span class="p">(</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="n">k</span><span class="p">)</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>  <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">calcJacobiDet</span><span class="p">(</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="n">k</span><span class="p">)</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">RSM_angle</span><span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">delta_theta</span><span class="o">*</span><span class="n">convergence_XRays</span><span class="p">)</span>
            <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">11</span><span class="p">]</span><span class="o">/</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">RSMQ_list</span><span class="p">,</span> <span class="n">delta_theta</span></div>

<div class="viewcode-block" id="CalcPathList"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.CalcPathList">[docs]</a><span class="k">def</span> <span class="nf">CalcPathList</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">RSMQ_list</span><span class="p">,</span><span class="n">delta_theta</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function creates a list of the qx-qz pixels resulting from the</span>
<span class="sd">    omega bins and the delta theta of the pixels. The four corners of the angle bin</span>
<span class="sd">    are transformed into qx-qz-space and form an area in reciprocal space.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sample_name: string</span>
<span class="sd">        name of the measured sample (named reference file)</span>
<span class="sd">    RSMQ_list: 2D numpy array </span>
<span class="sd">        contains the intensity as function of the position in reciprocal space and the angles</span>
<span class="sd">    delta_theta:  float</span>
<span class="sd">        describes the angle space due to the real space dimension of teh pixels [rad]</span>
<span class="sd">    k: float</span>
<span class="sd">        wave vector of the X-rays</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    path_list : list</span>
<span class="sd">        list of the arrays describing an area in reciprocal space&quot;&quot;&quot;</span>
            
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculating Polygon Path List: &#39;</span> <span class="o">+</span> <span class="n">sample_name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">path_list</span> <span class="o">=</span> <span class="p">[]</span>        
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">RSMQ_list</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
        <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mplPath</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">calcQzQx</span><span class="p">(</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">delta_theta</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">calcQzQx</span><span class="p">(</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">delta_theta</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">calcQzQx</span><span class="p">(</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta_theta</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">calcQzQx</span><span class="p">(</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="n">RSMQ_list</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta_theta</span><span class="p">,</span><span class="n">k</span><span class="p">)])))</span>
    <span class="k">return</span> <span class="n">path_list</span></div>

<div class="viewcode-block" id="PlotList"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.PlotList">[docs]</a><span class="k">def</span> <span class="nf">PlotList</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">RSMQ_list</span><span class="p">,</span><span class="n">path_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function plots the intensity of the Raw RSM in qx-qz-space distributed</span>
<span class="sd">    over the area calculated in the path list. The polygons map the reciprocal space. </span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    sample_name: string</span>
<span class="sd">        name of the measured sample (named reference file)</span>
<span class="sd">    RSMQ_list: 2D numpy array </span>
<span class="sd">        contains the intensity as function of the position</span>
<span class="sd">        in reciprocal space and the angles</span>
<span class="sd">    path_list : list</span>
<span class="sd">        last of the arrays describing an area in reciprocal space&quot;&quot;&quot;</span> 
    
    <span class="n">h</span><span class="o">.</span><span class="n">makeFolder</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">GetLabel</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/ExportedFigures&#39;</span><span class="p">)</span>
    <span class="n">patch_list</span> <span class="o">=</span> <span class="p">[]</span>        
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">RSMQ_list</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>        
        <span class="n">patch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">path_list</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="n">patch_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>    
    <span class="n">p</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">patch_list</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">rvb</span> <span class="p">,</span> <span class="n">array</span> <span class="o">=</span><span class="n">RSMQ_list</span><span class="p">[:,</span><span class="mi">12</span><span class="p">],</span><span class="n">edgecolors</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">()</span> <span class="p">)</span>                    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;qz [1/Ang]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;qx [1/Ang]&#39;</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>  
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;X-Ray reflectivity density $I/I_0$  $[\frac{photons Ang^2}</span><span class="si">{V}</span><span class="s1">]$&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RSMQList</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">RSMQList</span><span class="p">[:,</span><span class="mi">7</span><span class="p">])])</span>        
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RSMQList</span><span class="p">[:,</span><span class="mi">8</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">RSMQList</span><span class="p">[:,</span><span class="mi">8</span><span class="p">])])</span>      
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">GetLabel</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/ExportedFigures/PolygonRSM.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="createQGrid"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.createQGrid">[docs]</a><span class="k">def</span> <span class="nf">createQGrid</span><span class="p">(</span><span class="n">unique_omega</span><span class="p">,</span><span class="n">pixels</span><span class="p">,</span><span class="n">qz_min</span><span class="p">,</span><span class="n">qz_max</span><span class="p">,</span><span class="n">qx_min</span><span class="p">,</span><span class="n">qx_max</span><span class="p">,</span><span class="n">qz_oversampling</span><span class="p">,</span><span class="n">qx_oversampling</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function creates a grid in qx-qz space with bins along both directions.</span>
<span class="sd">    The gird along qz is given by the measured omega angles and the number of pixels</span>
<span class="sd">    determines the resolution along qx. </span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    unique_omega: 1D numpy array</span>
<span class="sd">        contains the measured omega angles</span>
<span class="sd">    pixels: 1D numpy array</span>
<span class="sd">        contains the detector pixels</span>
<span class="sd">    qz_min: float</span>
<span class="sd">        describes the lower border of the analysed part of qx-qz space</span>
<span class="sd">    qz_max: float</span>
<span class="sd">        describes the upper border of the analysed part of qx-qz space</span>
<span class="sd">    qx_min: float</span>
<span class="sd">        describes the lower border of the analysed part of qx-qz space</span>
<span class="sd">    qx_max: float</span>
<span class="sd">        describes the upper border of the analysed part of qx-qz space</span>
<span class="sd">    qz_oversampling: float</span>
<span class="sd">        describes the additional resolution along qz</span>
<span class="sd">    qx_oversampling: float</span>
<span class="sd">        describes the additional resolution along qx</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    qz_grid: 1D numpy array</span>
<span class="sd">        contains the steps along qz</span>
<span class="sd">    qx_grid: 1D numpy array</span>
<span class="sd">        contains the steps along qx</span>
<span class="sd">    qz_bins: list</span>
<span class="sd">        the boxes with left and right border to sort intensity</span>
<span class="sd">    qx_bins: list</span>
<span class="sd">        the boxes with left and right border to sort intensity</span>
<span class="sd">    qz_delta: float</span>
<span class="sd">        width of the bins along qz</span>
<span class="sd">    qx_delta: float</span>
<span class="sd">        width of the bins along qx&quot;&quot;&quot;</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating the Grid in Qspace: &#39;</span><span class="p">)</span>
    <span class="n">qz_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">qz_min</span><span class="p">,</span><span class="n">qz_max</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">qz_oversampling</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_omega</span><span class="p">)))</span>
    <span class="n">qx_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">qx_min</span><span class="p">,</span><span class="n">qx_max</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">qx_oversampling</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pixels</span><span class="p">)))</span> 
    <span class="n">qz_delta</span><span class="p">,</span><span class="n">qzL</span><span class="p">,</span><span class="n">qzR</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">calcGridBoxes</span><span class="p">(</span><span class="n">qz_grid</span><span class="p">)</span> 
    <span class="n">qx_delta</span><span class="p">,</span><span class="n">qxL</span><span class="p">,</span><span class="n">qxR</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">calcGridBoxes</span><span class="p">(</span><span class="n">qx_grid</span><span class="p">)</span>
    <span class="n">qz_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qzL</span><span class="p">,</span><span class="n">qzR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>       
    <span class="n">qx_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qxL</span><span class="p">,</span><span class="n">qxR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">qz_grid</span><span class="p">,</span> <span class="n">qx_grid</span><span class="p">,</span> <span class="n">qz_bins</span><span class="p">,</span> <span class="n">qx_bins</span><span class="p">,</span> <span class="n">qz_delta</span><span class="p">,</span> <span class="n">qx_delta</span></div>

<div class="viewcode-block" id="CreateMapping"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.CreateMapping">[docs]</a><span class="k">def</span> <span class="nf">CreateMapping</span><span class="p">(</span><span class="n">qzList</span><span class="p">,</span><span class="n">qxList</span><span class="p">,</span><span class="n">pathList</span><span class="p">,</span><span class="n">RSMQList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The points of the recipracl grid which are in the polygon of the &#39;pathlist&#39; are associated with </span>
<span class="sd">    the intensity from the Raw RSM corresponding to a pixel and an omega angle. THus every point in the </span>
<span class="sd">    QGrid gets an associated intensity.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    qzList: 1D numpy array</span>
<span class="sd">        contains all qz values for each qx value within the QGrid</span>
<span class="sd">    qxList: 1D numpy array</span>
<span class="sd">        contains all qx values for each qz value within the QGrid</span>
<span class="sd">    pathList: list</span>
<span class="sd">        contains arrays describing the polygons in reciprocal space</span>
<span class="sd">    RSMQList: 2D numpy array</span>
<span class="sd">        contains the intensity as function of the position in reciprocal space and the angles</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    QGridListTemp: 2D numpy array</span>
<span class="sd">        relates every point in QGrid to information in RSMQList&quot;&quot;&quot;</span>
    
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">qzList</span><span class="p">,</span><span class="n">qxList</span><span class="p">])</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">QGridListTemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">qzList</span><span class="p">),</span><span class="mi">13</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pathList</span><span class="p">))):</span>
        <span class="n">select</span> <span class="o">=</span> <span class="n">pathList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">contains_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">QGridListTemp</span><span class="p">[</span><span class="n">select</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">RSMQList</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">QGridListTemp</span></div>

<div class="viewcode-block" id="CalcQGridList"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.CalcQGridList">[docs]</a><span class="k">def</span> <span class="nf">CalcQGridList</span><span class="p">(</span><span class="n">qzGrid</span><span class="p">,</span><span class="n">qxGrid</span><span class="p">,</span><span class="n">pathList</span><span class="p">,</span><span class="n">RSMQList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function creates a list of the QGrid, where each point of the QGrid is associated with </span>
<span class="sd">    an intensity as in the RSMQList.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    qzGrid: 1D numpy array</span>
<span class="sd">        contains the steps along qz</span>
<span class="sd">    qxGrid: 1D numpy array</span>
<span class="sd">        contains the steps along qx</span>
<span class="sd">    pathList: list</span>
<span class="sd">        contains arrays describing the polygons in reciprocal space</span>
<span class="sd">    RSMQList: 2D numpy array</span>
<span class="sd">        contains the intensity as function of the position in reciprocal space and the angles</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    QGridList: 2D numpy array</span>
<span class="sd">        relates every point in QGrid to information in RSMQList&quot;&quot;&quot;</span>
    <span class="n">QGridList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qzGrid</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qxGrid</span><span class="p">),</span><span class="mi">18</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="k">for</span> <span class="n">lx</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qxGrid</span><span class="p">))):</span>
        <span class="k">for</span> <span class="n">lz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qzGrid</span><span class="p">)):</span>
            <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
            <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lz</span>
            <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lx</span>
            <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">qzGrid</span><span class="p">[</span><span class="n">lz</span><span class="p">]</span>
            <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">qxGrid</span><span class="p">[</span><span class="n">lx</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">QGridListTemp</span> <span class="o">=</span> <span class="n">CreateMapping</span><span class="p">(</span><span class="n">QGridList</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">QGridList</span><span class="p">[:,</span><span class="mi">4</span><span class="p">],</span><span class="n">pathList</span><span class="p">,</span><span class="n">RSMQList</span><span class="p">)</span>
    <span class="n">QGridList</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGridListTemp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">QGridList</span></div>

<div class="viewcode-block" id="SortListToRSMQ"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.SortListToRSMQ">[docs]</a><span class="k">def</span> <span class="nf">SortListToRSMQ</span><span class="p">(</span><span class="n">qxGrid</span><span class="p">,</span><span class="n">qzGrid</span><span class="p">,</span><span class="n">QGridList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function generates on the basis of &#39;QGrisList&#39; a two dimensional RSM.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    qzGrid: 1D numpy array</span>
<span class="sd">        contains the steps along qz</span>
<span class="sd">    qxGrid: 1D numpy array</span>
<span class="sd">        contains the steps along qx</span>
<span class="sd">    QGridList: 2D numpy array</span>
<span class="sd">        relates every point in QGrid to information in RSMQList</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    RSMQ: 2D numpy array</span>
<span class="sd">        intensity in qx (lines) and qz (columns)&quot;&quot;&quot;</span>
        
    <span class="n">RSMQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qxGrid</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qzGrid</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qxGrid</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qzGrid</span><span class="p">)):</span>       
        <span class="n">RSMQ</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">RSMQ</span></div>

<div class="viewcode-block" id="plotRSMQ"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.plotRSMQ">[docs]</a><span class="k">def</span> <span class="nf">plotRSMQ</span><span class="p">(</span><span class="n">sampleName</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">RSMQ</span><span class="p">,</span><span class="n">qzBins</span><span class="p">,</span><span class="n">qxBins</span><span class="p">,</span><span class="n">delay</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function plots the RSM with orthogonal bins.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sampleName: string </span>
<span class="sd">        name of the measured sample (named reference file)</span>
<span class="sd">    number: integer</span>
<span class="sd">        line in the reference datafile wich corresponds to the measurement</span>
<span class="sd">    RSMQ: 2D numpy array</span>
<span class="sd">        intensity in qx (lines) and qz (columns)</span>
<span class="sd">    qzBins: list</span>
<span class="sd">        the boxes with left and right border to sort intensity</span>
<span class="sd">    qxBins: list</span>
<span class="sd">        the boxes with left and right border to sort intensity</span>
<span class="sd">    delay: float</span>
<span class="sd">        the element of uniqueDelays corresponding to RSM&quot;&quot;&quot;</span> 
        
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting RSMQ ... &#39;</span><span class="p">)</span> 
    <span class="n">h</span><span class="o">.</span><span class="n">makeFolder</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">GetLabel</span><span class="p">(</span><span class="n">sampleName</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/ExportedFigures&#39;</span><span class="p">)</span>       
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">qzBins</span><span class="p">,</span><span class="n">qxBins</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">RSMQ</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rvb</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1e8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;X-Ray reflectivity density $I/I_0$  $[\frac{photons Ang^2}</span><span class="si">{V}</span><span class="s1">]$&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;qz [ 1/Ang ]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;qx [ 1/Ang ]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;RawData/&#39;</span> <span class="o">+</span> <span class="n">GetLabel</span><span class="p">(</span><span class="n">sampleName</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/ExportedFigures/RSM.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="SortRSMRawToQGridList"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.SortRSMRawToQGridList">[docs]</a><span class="k">def</span> <span class="nf">SortRSMRawToQGridList</span><span class="p">(</span><span class="n">QGridList</span><span class="p">,</span><span class="n">RSMRaw</span><span class="p">,</span><span class="n">deltaTheta</span><span class="p">,</span><span class="n">convergenceXRays</span><span class="p">,</span><span class="n">pixels</span><span class="p">,</span><span class="n">uniqueOmega</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function uses &#39;QGridList&#39; and sorts the new intensities from &#39;RSMRaw&#39; into the bins.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    QGridList: 2D numpy array</span>
<span class="sd">        relates every point in QGrid to information in RSMQList</span>
<span class="sd">    RSMRaw: 2D numpy array</span>
<span class="sd">        contains intensity as function of pixels and omega angles</span>
<span class="sd">    deltaTheta:  float</span>
<span class="sd">        describes the angle space due to the real space dimension of teh pixels [rad]</span>
<span class="sd">    convergenceXRays: float</span>
<span class="sd">        convergence angle of incident X-rays [rad]</span>
<span class="sd">    pixels: 1D numpy array</span>
<span class="sd">        contains the detector pixels</span>
<span class="sd">    uniqueOmega: 1D array</span>
<span class="sd">        contains the unique measured omgea angle values</span>
<span class="sd">       </span>
<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    QGridList: 2D numpy array</span>
<span class="sd">        relates every point in QGrid to intensity in RSMRaw&quot;&quot;&quot;</span> 
        
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">QGridList</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span> 
        <span class="k">if</span> <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span>  <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pixels</span><span class="p">)</span> <span class="ow">and</span> <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniqueOmega</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">RSMRaw</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">7</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">6</span><span class="p">])]</span>
            <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">15</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">deltaTheta</span><span class="o">*</span><span class="n">convergenceXRays</span><span class="p">)</span>
            <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span><span class="o">/</span><span class="n">QGridList</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">14</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">QGridList</span></div>

<span class="k">def</span> <span class="nf">GetRockingCurveRSMQ</span><span class="p">(</span><span class="n">RSMQ</span><span class="p">,</span><span class="n">direction</span><span class="p">,</span><span class="n">qzDelta</span><span class="p">,</span><span class="n">qxDelta</span><span class="p">,</span><span class="n">qzRange</span><span class="p">,</span><span class="n">qxRange</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span>     
        <span class="n">rockingCurve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RSMQ</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">qzDelta</span><span class="o">*</span><span class="n">qxRange</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rockingCurve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RSMQ</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">qxDelta</span><span class="o">*</span><span class="n">qzRange</span>
    <span class="k">return</span> <span class="n">rockingCurve</span>

<span class="k">def</span> <span class="nf">Write1DArrayToFileWithoutLineBreak</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">Array</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Array</span><span class="p">)):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        
<span class="k">def</span> <span class="nf">Write1DArrayToFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">Array</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Array</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="PrepareRockingCurveFile"><a class="viewcode-back" href="../../../pxs.html#udkm.pxs.rsm.PrepareRockingCurveFile">[docs]</a><span class="k">def</span> <span class="nf">PrepareRockingCurveFile</span><span class="p">(</span><span class="n">sampleName</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">qAxis</span><span class="p">):</span>        
    <span class="sd">&quot;&quot;&quot; Starts the files where all Rocking-Curves along qz are stored &quot;&quot;&quot;</span>
    <span class="n">h</span><span class="o">.</span><span class="n">makeFolder</span><span class="p">(</span><span class="s1">&#39;ExportedRockingCurves/&#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sampleName</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;0 Delay&quot;</span><span class="p">,</span><span class="s2">&quot;1 DelayLoop&quot;</span><span class="p">,</span><span class="s2">&quot;2 OmeagaLoop&quot;</span><span class="p">,</span> <span class="s2">&quot;3 -end Rockingcurve&quot;</span><span class="p">]</span>    
    <span class="n">rockingCurveFileName</span> <span class="o">=</span> <span class="s1">&#39;ExportedRockingCurves/&#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sampleName</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39;/qzRockingCurves&#39;</span> <span class="o">+</span> <span class="n">ReadParameter</span><span class="p">(</span><span class="n">sampleName</span><span class="p">,</span><span class="n">number</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.dat&#39;</span>             
    <span class="n">rockingCurveFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">rockingCurveFileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">rockingCurveFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;% &#39;</span><span class="p">)</span>
    <span class="n">Write1DArrayToFile</span><span class="p">(</span><span class="n">rockingCurveFile</span><span class="p">,</span><span class="n">header</span><span class="p">)</span>
    <span class="n">Write1DArrayToFileWithoutLineBreak</span><span class="p">(</span><span class="n">rockingCurveFile</span><span class="p">,[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">Write1DArrayToFile</span><span class="p">(</span><span class="n">rockingCurveFile</span><span class="p">,</span><span class="n">qAxis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rockingCurveFile</span></div>
 
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Alexander von Reppert.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>