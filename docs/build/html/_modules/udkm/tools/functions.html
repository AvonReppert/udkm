
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>udkm.tools.functions &#8212; udkm 0.0.1</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">udkm 0.0.1</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/AleksUDKM/udkm">
   github project page
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pxs.html">
   pxs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../moke.html">
   moke
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../tools.html">
   tools
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <h1>Source code for udkm.tools.functions</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Sun Dec 19 21:29:02 2021</span>
<span class="sd">@author: Aleks</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="k">as</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">zipfile</span> <span class="k">as</span> <span class="nn">zipfile</span>

<span class="n">teststring</span> <span class="o">=</span> <span class="s2">&quot;Successfully loaded udkm.tools.functions&quot;</span>


<div class="viewcode-block" id="fft"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.fft">[docs]</a><span class="k">def</span> <span class="nf">fft</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns fft of the y_data and frequency  axis&quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x-axis and first dimension of the data matrix do not have identical size!&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x_data</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">length</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">length_2</span> <span class="o">=</span> <span class="n">length</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">length_2</span> <span class="o">=</span> <span class="n">length</span><span class="o">-</span><span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;last data point omitted!&#39;</span><span class="p">)</span>

    <span class="n">fft_size</span> <span class="o">=</span> <span class="n">length_2</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">ft_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">y_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">length_2</span><span class="p">])</span><span class="o">/</span><span class="n">length_2</span><span class="p">)</span>
    <span class="n">ft_x_axis</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fft_size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ft_x_axis</span><span class="p">,</span> <span class="n">ft_data</span></div>


<div class="viewcode-block" id="calc_fluence"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.calc_fluence">[docs]</a><span class="k">def</span> <span class="nf">calc_fluence</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">fwhm_x</span><span class="p">,</span> <span class="n">fwhm_y</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">rep_rate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns the fluence</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    power : float</span>
<span class="sd">        incident power in mW</span>
<span class="sd">    fwhm_x : float</span>
<span class="sd">        Full Width at Half Maximum of the (gaussian) pump beam in x-direction in microns</span>
<span class="sd">    fwhm_y : float</span>
<span class="sd">        Full Width at Half Maximum of the (gaussian) pump beam in y-direction in microns</span>
<span class="sd">    angle : float</span>
<span class="sd">        angle of incidence of the pump beam in degree relative to surface normal</span>
<span class="sd">    rep_rate : float</span>
<span class="sd">        repetition rate of the used laser</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">        fluence : float</span>
<span class="sd">          calculated fluence in mJ/cm^2</span>

<span class="sd">    Example</span>
<span class="sd">    ------</span>
<span class="sd">        &gt;&gt;&gt; calc_fluence(50,500*1e-4,400*1e-4,45,1000) &quot;&quot;&quot;</span>
    <span class="c1"># Umrechung von Grad in Bogenma√ü</span>
    <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="c1"># Berechnung der Fluenz</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">fwhm_x</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">*</span><span class="mf">1e-4</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">fwhm_y</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">*</span><span class="mf">1e-4</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x0</span><span class="o">*</span><span class="n">y0</span>
    <span class="n">fluence</span> <span class="o">=</span> <span class="n">power</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rep_rate</span><span class="o">*</span><span class="n">area</span><span class="p">)</span>  <span class="c1"># in mJ/cm^2</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">fluence</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="calc_moments"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.calc_moments">[docs]</a><span class="k">def</span> <span class="nf">calc_moments</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y_values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; calculates the center of mass, standard deviation and integral of a given distribution</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        x_axis : 1D numpy array</span>
<span class="sd">            numpy array containing the x Axis</span>
<span class="sd">        y_values : 1D numpy array</span>
<span class="sd">            numpy array containing the according y Values</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    in that order</span>
<span class="sd">        com : float</span>
<span class="sd">            xValue of the Center of Mass of the data</span>

<span class="sd">        std : float</span>
<span class="sd">            xValue for the standard deviation of the data around the center of mass</span>

<span class="sd">        integral :</span>
<span class="sd">            integral of the data</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">        &gt;&gt;&gt; com,std,integral = calcMoments([1,2,3],[1,1,1])</span>
<span class="sd">            sould give a com of 2, a std of 1 and an integral of 3 &quot;&quot;&quot;</span>

    <span class="n">com</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">y_values</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">((</span><span class="n">x_axis</span><span class="o">-</span><span class="n">com</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">y_values</span><span class="p">))</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">calc_grid_boxes</span><span class="p">(</span><span class="n">x_axis</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_values</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">com</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">integral</span></div>


<div class="viewcode-block" id="calc_grid_boxes"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.calc_grid_boxes">[docs]</a><span class="k">def</span> <span class="nf">calc_grid_boxes</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; calculates the size of a grid cell and the left and right boundaries of each gridcell</span>
<span class="sd">    in a monotonous but possibly nonlinear grid</span>

<span class="sd">   Parameters</span>
<span class="sd">   ----------</span>
<span class="sd">       vector : 1D numpy array</span>
<span class="sd">                numpy array containing a monotonous grid with points</span>
<span class="sd">   Returns</span>
<span class="sd">   ------</span>
<span class="sd">   in that order</span>
<span class="sd">       delta : 1D numpy array of same length as vector</span>
<span class="sd">               the distance to the left and right neighbor devided by 2</span>
<span class="sd">       left : 1D numpy array of same length as vector</span>
<span class="sd">           left boundaries of the grid cell</span>
<span class="sd">       right : 1D numpy array of same length as vector</span>
<span class="sd">           right boundaries of the grid cell</span>
<span class="sd">   Example</span>
<span class="sd">   -------</span>
<span class="sd">       &gt;&gt;&gt; delta,right,left = calc_grid_boxes([0,1,2,4])</span>
<span class="sd">           (array([ 1. ,  1. ,  1.5,  2. ]),</span>
<span class="sd">            array([-0.5,  0.5,  1.5,  3. ]),</span>
<span class="sd">            array([ 0.5,  1.5,  3. ,  5. ]))&quot;&quot;&quot;</span>

    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">delta</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">left</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="n">delta</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">right</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">delta</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">left</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">right</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">left</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">right</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">delta</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="n">left</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">delta</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span></div>


<div class="viewcode-block" id="find"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.find">[docs]</a><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This little function returns the index of the array where the array value is closest to the key</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : 1D numpy array</span>
<span class="sd">            numpy array with values</span>
<span class="sd">    key :   float value</span>
<span class="sd">            The value that one looks for in the array</span>
<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    index :     integer</span>
<span class="sd">                index of the array value closest to the key</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; index = find(np.array([1,2,3]),3)</span>
<span class="sd">    will return 2&quot;&quot;&quot;</span>
    <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array</span><span class="o">-</span><span class="n">key</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">index</span></div>


<div class="viewcode-block" id="rel_change"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.rel_change">[docs]</a><span class="k">def</span> <span class="nf">rel_change</span><span class="p">(</span><span class="n">data_array</span><span class="p">,</span> <span class="n">fixpoint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns relative change of a measured quantity relative to a given value</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_array : 1D numpy array</span>
<span class="sd">        array containing the data</span>

<span class="sd">    fixpoint : float</span>
<span class="sd">        Quantity to which the relative change is calculated</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">        rel_change_array : 1D numpy array with same length as data_array</span>
<span class="sd">        contains (data_array-fixpoint)/fixpoint</span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">        &gt;&gt;&gt; change = relChange(cAxisDy,cAxisDy[T==300])&quot;&quot;&quot;</span>
    <span class="n">rel_change_array</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_array</span><span class="o">-</span><span class="n">fixpoint</span><span class="p">)</span><span class="o">/</span><span class="n">fixpoint</span>
    <span class="k">return</span><span class="p">(</span><span class="n">rel_change_array</span><span class="p">)</span></div>


<div class="viewcode-block" id="set_roi_1d"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.set_roi_1d">[docs]</a><span class="k">def</span> <span class="nf">set_roi_1d</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; selects a rectangular region of intrest roi from a 2D matrix based on the</span>
<span class="sd">    passed boundaries x_min,x_max, y_min and y_max. x stands for the columns of the</span>
<span class="sd">    matrix, y for the rows</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        x_axis: 1D numpy arrays</span>
<span class="sd">            numpy array containing the x grid</span>
<span class="sd">        Values : 1D numpy array same length as x_axis</span>

<span class="sd">        x_min,x_max: inclusive Boundaries for the roi</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    in that order</span>
<span class="sd">        x_roi : 1D numpy array slice of x_axis between x_min and x_max</span>

<span class="sd">        roi : 1D numpy array of same length as vector</span>


<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">        &gt;&gt;&gt; qz_cut,roi = setroimatrix(qzgrid,RockingQz,2.1,2.2)&quot;&quot;&quot;</span>

    <span class="n">select_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">x_axis</span> <span class="o">&gt;=</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_axis</span> <span class="o">&lt;=</span> <span class="n">x_max</span><span class="p">)</span>
    <span class="n">x_roi</span> <span class="o">=</span> <span class="n">x_axis</span><span class="p">[</span><span class="n">select_x</span><span class="p">]</span>
    <span class="n">roi</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">select_x</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x_roi</span><span class="p">,</span> <span class="n">roi</span></div>


<div class="viewcode-block" id="set_roi_2d"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.set_roi_2d">[docs]</a><span class="k">def</span> <span class="nf">set_roi_2d</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; selects a rectangular region of intrest roi from a 2D matrix based on the</span>
<span class="sd">    passed boundaries x_min,x_max, y_min and y_max. x stands for the columns of the</span>
<span class="sd">    matrix, y for the rows</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        x_axis, y_axis : 1D numpy arrays</span>
<span class="sd">            numpy arrays containing the x and y grid respectively</span>
<span class="sd">        matrix : 2D numpy array</span>
<span class="sd">            2D array with the shape (len(y_axis),len(x_axis))</span>
<span class="sd">        x_min,x_max,y_min,y_max : inclusive Boundaries for the roi</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    in that order</span>
<span class="sd">        x_roi : 1D numpy array slice of x_axis between x_min and x_max</span>

<span class="sd">        y_roi : 1D numpy array slice of y_axis between y_min and y_max</span>

<span class="sd">        roi : 2D numpy array of same length as vector</span>

<span class="sd">        x_integral : 1D numpy arrays with the same length as x_roi</span>
<span class="sd">            array containing the sum of roi over the y direction</span>

<span class="sd">        y_integral : 1D numpy arrays with the same length as y_roi</span>
<span class="sd">            array containing the sum of roi over the x direction</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">        &gt;&gt;&gt; qz_cut,qx_cut,roi,x_integral,y_integral = setroimatrix(qzgrid,qxgrid,rsm_q,2.1,2.2,-0.5,0.5)&quot;&quot;&quot;</span>

    <span class="n">select_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">x_axis</span> <span class="o">&gt;=</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_axis</span> <span class="o">&lt;=</span> <span class="n">x_max</span><span class="p">)</span>
    <span class="n">select_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">y_axis</span> <span class="o">&gt;=</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_axis</span> <span class="o">&lt;=</span> <span class="n">y_max</span><span class="p">)</span>

    <span class="n">x_roi</span> <span class="o">=</span> <span class="n">x_axis</span><span class="p">[</span><span class="n">select_x</span><span class="p">]</span>
    <span class="n">y_roi</span> <span class="o">=</span> <span class="n">y_axis</span><span class="p">[</span><span class="n">select_y</span><span class="p">]</span>
    <span class="n">roi</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">select_y</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">roi</span> <span class="o">=</span> <span class="n">roi</span><span class="p">[:,</span> <span class="n">select_x</span><span class="p">]</span>
    <span class="n">x_integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">y_integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x_roi</span><span class="p">,</span> <span class="n">y_roi</span><span class="p">,</span> <span class="n">roi</span><span class="p">,</span> <span class="n">x_integral</span><span class="p">,</span> <span class="n">y_integral</span></div>


<span class="k">def</span> <span class="nf">regrid_measurement</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_grid</span><span class="p">):</span>
    <span class="n">signal_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">signal_matrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">signal_matrix</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">signal_matrix_regridded</span> <span class="o">=</span> <span class="n">regrid_array</span><span class="p">(</span><span class="n">signal_matrix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x_grid</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">x_regridded</span> <span class="o">=</span> <span class="n">signal_matrix_regridded</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y_regridded</span> <span class="o">=</span> <span class="n">signal_matrix_regridded</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">std_x</span> <span class="o">=</span> <span class="n">signal_matrix_regridded</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">std_y</span> <span class="o">=</span> <span class="n">signal_matrix_regridded</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x_regridded</span><span class="p">,</span> <span class="n">y_regridded</span><span class="p">,</span> <span class="n">std_x</span><span class="p">,</span> <span class="n">std_y</span>


<div class="viewcode-block" id="regrid_array"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.regrid_array">[docs]</a><span class="k">def</span> <span class="nf">regrid_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">remove_columns</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns a new version of a numpy array where data are</span>
<span class="sd">    averaged within boxes of a given grid. The new array contains the average</span>
<span class="sd">    value of the datapoints within each gridbox. A list of columns that are removed</span>
<span class="sd">    in the new array or left untouched should be provided. If the datapoints coincide</span>
<span class="sd">    with the gridpoints this function reduces to a simple average.</span>
<span class="sd">    columns with the corresponding standard deviations are appended as columns</span>
<span class="sd">    to the end of the array in the same order as the average value columns.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : numpy array</span>
<span class="sd">            numpy array that contains separate data in columns</span>
<span class="sd">    column : integer</span>
<span class="sd">            integer number of the column to which the array will be regridded</span>
<span class="sd">    grid:  1D numpy array</span>
<span class="sd">            array that contains the gridpoints</span>
<span class="sd">            select = grid(i)&lt;= array(:,column) &amp; array(:,column)&lt; grid(i+1)</span>
<span class="sd">    remove_columns : list of integers</span>
<span class="sd">            list of columns that will be removed in the outpout</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    result : numpy array</span>
<span class="sd">        a numpy array that contains the regridded array with specified columns untouched and removed.</span>
<span class="sd">        The end of the array contains the standard deviation vectors.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">    &gt;&gt;&gt; all_data_avaraged =regrid_array(all_data_normalized,0,time_grid,[0,2,5,6])</span>

<span class="sd">    This returns a numpy array that is regridded according to column 1 and the specified time_grid.</span>
<span class="sd">    columns 0,2,5 and 6 are removed in the output. Only columns 1,3 and 4 remain and they will be column</span>
<span class="sd">    0,1,2 of the new array. column 3,4 and 5 five will contain the standard deviation of the values in column</span>
<span class="sd">    0,1,2 respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">column</span><span class="p">]</span>  <span class="c1"># This is the column according to which I regrid</span>
    <span class="n">array_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">remove_columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># This temporary array only contains the remaining columns</span>
    <span class="n">cols_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">array_temp</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">array_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols_new</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># This is the new array that will eventually be returned</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">select_1</span> <span class="o">=</span> <span class="n">time</span> <span class="o">&gt;=</span> <span class="n">grid</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">select_2</span> <span class="o">=</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="n">grid</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">select</span> <span class="o">=</span> <span class="n">select_1</span> <span class="o">&amp;</span> <span class="n">select_2</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">select</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">array_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">array_new</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">counter</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols_new</span><span class="p">):</span>
                <span class="n">array_new</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">counter</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array_temp</span><span class="p">[</span><span class="n">select</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>
                <span class="n">array_new</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">counter</span><span class="p">,</span> <span class="n">c</span><span class="o">+</span><span class="n">cols_new</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">array_temp</span><span class="p">[</span><span class="n">select</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">array_new</span><span class="p">)</span></div>


<div class="viewcode-block" id="smooth"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.smooth">[docs]</a><span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">window_len</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    smooth the data using a window with requested size.</span>

<span class="sd">    This method is based on the convolution of a scaled window with the signal.</span>
<span class="sd">    The signal is prepared by introducing reflected copies of the signal</span>
<span class="sd">    (with the window size) in both ends so that transient parts are minimized</span>
<span class="sd">    in the begining and end part of the output signal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x :     1D numpy array</span>
<span class="sd">            the input signal numpy array</span>
<span class="sd">    window_len : odd integer</span>
<span class="sd">                  the dimension of the smoothing window</span>
<span class="sd">    window :    string</span>
<span class="sd">                the type of window from &#39;flat&#39;, &#39;hanning&#39;, &#39;hamming&#39;, &#39;bartlett&#39;, &#39;blackman&#39;</span>
<span class="sd">                flat window will produce a moving average smoothing.</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    result : numpy array of the smoothed signal</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; t=linspace(-2,2,0.1)</span>
<span class="sd">    &gt;&gt;&gt; x=sin(t)+randn(len(t))*0.1</span>
<span class="sd">    &gt;&gt;&gt; y=smooth(x)</span>

<span class="sd">    see also:</span>
<span class="sd">    numpy.hanning, numpy.hamming, numpy.bartlett, numpy.blackman, numpy.convolve</span>
<span class="sd">    scipy.signal.lfilter</span>
<span class="sd">    the window parameter could be the window itself as an array instead of a string &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s2">&quot;smooth only accepts 1 dimension arrays.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">window_len</span><span class="p">:</span>
        <span class="k">raise</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s2">&quot;Input vector needs to be bigger than window size.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">window_len</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">if</span> <span class="n">window</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;flat&#39;</span><span class="p">,</span> <span class="s1">&#39;hanning&#39;</span><span class="p">,</span> <span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="s1">&#39;bartlett&#39;</span><span class="p">,</span> <span class="s1">&#39;blackman&#39;</span><span class="p">]:</span>
        <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s2">&quot;Window is none of &#39;flat&#39;, &#39;hanning&#39;, &#39;hamming&#39;, &#39;bartlett&#39;, &#39;blackman&#39;&quot;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">window_len</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="n">window_len</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="c1"># print(len(s))</span>
    <span class="k">if</span> <span class="n">window</span> <span class="o">==</span> <span class="s1">&#39;flat&#39;</span><span class="p">:</span>  <span class="c1"># moving average</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">window_len</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;np.&#39;</span><span class="o">+</span><span class="n">window</span><span class="o">+</span><span class="s1">&#39;(window_len)&#39;</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="n">w</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">window_len</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">window_len</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span></div>


<div class="viewcode-block" id="write_list_to_file"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.write_list_to_file">[docs]</a><span class="k">def</span> <span class="nf">write_list_to_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This procedure writes a 2D array or list to an unopened file.</span>
<span class="sd">    rows are written as lines. The elements are separated by tabs.</span>
<span class="sd">    Rows are separated by linebreaks. The first line is preceded by a &quot;#&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : string</span>
<span class="sd">            Path to the file_name where the file will be stored</span>
<span class="sd">    header : string</span>
<span class="sd">            First line of the datafile that will be written</span>
<span class="sd">    list : list, or 2D numpy array</span>
<span class="sd">            list which is written to the File</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; h.write_list_to_file(&quot;test.dat&quot;,&quot;temp \t x0 \t sigma&quot;, np.array([[170, 12.3, 1.34],[ 180, 11.53, 1.4]]))</span>

<span class="sd">    Creates a new file and writes the full list in your file (plus header)</span>
<span class="sd">    The created file looks like:</span>

<span class="sd">        # temp   x0  sigma</span>
<span class="sd">        170     12.3    1.34</span>
<span class="sd">        180     11.53    1.4</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">write_2d_array_to_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span></div>


<div class="viewcode-block" id="write_single_line_to_file"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.write_single_line_to_file">[docs]</a><span class="k">def</span> <span class="nf">write_single_line_to_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This procedure writes a list or a 1D-numpy array as single line to a file</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : string</span>
<span class="sd">            relative (or absolute) path to the file to which the line will written</span>
<span class="sd">    header : string</span>
<span class="sd">            First line of the datafile that will be written. It is preceded by a &#39;#&#39;</span>
<span class="sd">    line : list, 1D-numpy-array</span>
<span class="sd">            the elements of the line will be appended to the specified file columns</span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; write_single_line_to_file(&#39;test.dat&#39;,&#39; Number [ ]\t  Fitresults &#39;, [1,1.2, 12, 14, &quot;a&quot;])</span>

<span class="sd">    Creates a file that will look like:</span>
<span class="sd">    # Number [ ]    Fitresults</span>
<span class="sd">    1   1.2     12  14  a</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">write_1d_array_to_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span></div>


<div class="viewcode-block" id="write_columns_to_file"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.write_columns_to_file">[docs]</a><span class="k">def</span> <span class="nf">write_columns_to_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This procedure writes an arbitrary number of 1D arrays into a single file as columns with</span>
<span class="sd">    the specified header as first line.</span>
<span class="sd">    Tabs are used as separation sign</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : string</span>
<span class="sd">    Path to the file_name where the file will be stored</span>
<span class="sd">    header : string</span>
<span class="sd">    First line of the datafile that will be written</span>
<span class="sd">    data : 1D arrays separated by &quot;,&quot;</span>
<span class="sd">       1D arrays of the same length that will be written to the file as columns</span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; a=np.ones(4)</span>
<span class="sd">    &gt;&gt;&gt; b=np.zeros(4)</span>
<span class="sd">    &gt;&gt;&gt; c=np.ones(4)</span>
<span class="sd">    &gt;&gt;&gt; write_columns_to_file(&#39;EraseMe.txt&#39;,&#39;Time \t FirstPeak \t SecondPeak&#39;,a,b,c)</span>
<span class="sd">    Will write the following content to the file &#39;EraseMe.txt&#39;:</span>

<span class="sd">    # Time  FirstPeak   SecondPeak</span>
<span class="sd">    1.0     0.0    1.0</span>
<span class="sd">    1.0     0.0    1.0</span>
<span class="sd">    1.0     0.0    1.0</span>
<span class="sd">    1.0     0.0    1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span></div>


<div class="viewcode-block" id="write_1d_array_to_file"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.write_1d_array_to_file">[docs]</a><span class="k">def</span> <span class="nf">write_1d_array_to_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     This procedure writes a 1D array or list to an already opened file with the</span>
<span class="sd">     identifier f as a line. The elements are separated by tabs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f : file identifier</span>
<span class="sd">       file identifier of the already opened file</span>
<span class="sd">    array : 1D-numpy-array or list</span>
<span class="sd">    Data line</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    This is how you typically would use the function:</span>

<span class="sd">    &gt;&gt;&gt; f = open(&quot;test.dat&quot;, &#39;a&#39;)</span>
<span class="sd">    &gt;&gt;&gt; line = [1,2,3]</span>
<span class="sd">    &gt;&gt;&gt; write_1d_array_to_file(f,line)</span>
<span class="sd">    &gt;&gt;&gt; f.close</span>

<span class="sd">    This appends the line:</span>

<span class="sd">    1   2   3</span>

<span class="sd">    to the file &#39;test.dat&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="write_2d_array_to_file"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.write_2d_array_to_file">[docs]</a><span class="k">def</span> <span class="nf">write_2d_array_to_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     This procedure writes a 2D array or list to an already opened file with</span>
<span class="sd">     the identifier f. The elements are separated by tabs and new rows are</span>
<span class="sd">     indicated by line breaks.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f : file identifier</span>
<span class="sd">       file identifier of the already opened file</span>
<span class="sd">    array : 2D-numpy-array or list</span>
<span class="sd">        data line</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    This is how you typically would use the function:</span>

<span class="sd">    &gt;&gt;&gt; f = open(&quot;test.dat&quot;, &#39;a&#39;)</span>
<span class="sd">    &gt;&gt;&gt; array = [1,2,3;4,5,6]</span>
<span class="sd">    &gt;&gt;&gt; write_2d_array_to_file(f,array)</span>
<span class="sd">    &gt;&gt;&gt; f.close</span>

<span class="sd">    This appends the lines:</span>

<span class="sd">    1   2   3</span>
<span class="sd">    4   5   6</span>

<span class="sd">    to the file &#39;test.dat&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="append_single_line_to_file"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.append_single_line_to_file">[docs]</a><span class="k">def</span> <span class="nf">append_single_line_to_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     This procedure appends a list or a numpy array as single line to a file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : string</span>
<span class="sd">            relative (or absolute) path to the file to which the line will be appended</span>
<span class="sd">    line : list, 1D-numpy-array</span>
<span class="sd">            the elements of the line will be appended to the specified file columns</span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    Suppose you have the file list.dat that looks like:</span>

<span class="sd">        # Time  FirstPeak   SecondPeak</span>
<span class="sd">        1.0     0.0    1.0</span>
<span class="sd">        1.0     0.0    1.0</span>

<span class="sd">    and you call:</span>

<span class="sd">    &gt;&gt;&gt; append_single_line_to_file([1,2,3.2],&#39;list.dat&#39;)</span>

<span class="sd">    then it will look like:</span>

<span class="sd">        # Time  FirstPeak   SecondPeak</span>
<span class="sd">        1.0     0.0    1.0</span>
<span class="sd">        1.0     0.0    1.0</span>
<span class="sd">        1       2      3.2</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">write_1d_array_to_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span></div>


<span class="k">def</span> <span class="nf">save_dictionary</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">load_dictionary</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>


<div class="viewcode-block" id="unzip"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.unzip">[docs]</a><span class="k">def</span> <span class="nf">unzip</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This procedure unzips a specified archive &quot;archive.zip&quot; and stores its contents</span>
<span class="sd">    to the specified to the folder &quot;target&quot;. It only acts if a folder named &quot;target&quot; does not already exist.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    archive : string</span>
<span class="sd">            Path to the .zip archive relative to the working directory or absolute</span>
<span class="sd">    target : string</span>
<span class="sd">            Path to the folder into which the contents of archive will be unpacked</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; unzip(&quot;a&quot;,&quot;b&quot;)</span>
<span class="sd">    Extracts the contents of the archive archive &quot;a&quot; + &quot;.zip&quot; to a folder &quot;b&quot; if</span>
<span class="sd">    b does not alread exist.</span>
<span class="sd">    &gt;&gt;&gt; unzip(&quot;a&quot;,&quot;a&quot;)</span>
<span class="sd">    Extracts an archive into the same locaction of the file and keeps &quot;a&quot; as the</span>
<span class="sd">    name of the target folder if the folder a does not already exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">archive</span> <span class="o">+</span> <span class="s1">&#39;.zip&#39;</span><span class="p">)</span>
        <span class="n">z</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></div>


<div class="viewcode-block" id="make_folder"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.make_folder">[docs]</a><span class="k">def</span> <span class="nf">make_folder</span><span class="p">(</span><span class="n">path_to_folder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    creates an empty folder if the target folder does not already exist</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path_to_folder : string</span>
<span class="sd">    Path to the newly created folder</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; make_folder(&quot;subfolder/new_folder_name&quot;)</span>
<span class="sd">    Creates a new folder with the name &quot;NewFolder&quot; in the directory &quot;subfolder&quot;</span>
<span class="sd">    relative to the working path but only if this folder does not already exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_to_folder</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_to_folder</span><span class="p">)</span></div>


<div class="viewcode-block" id="timestring"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.timestring">[docs]</a><span class="k">def</span> <span class="nf">timestring</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a timestring made of 6 digits for the inserted time adding leading zeros if necessary.</span>
<span class="sd">    works also with arrays.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)))</span><span class="o">*</span><span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]))))</span><span class="o">*</span><span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="imagestring"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.imagestring">[docs]</a><span class="k">def</span> <span class="nf">imagestring</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a timestring made of 5 digits for the inserted time adding leading zeros if necessary.</span>
<span class="sd">    works also with arrays.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)))</span><span class="o">*</span><span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]))))</span><span class="o">*</span><span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="copy_files"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.copy_files">[docs]</a><span class="k">def</span> <span class="nf">copy_files</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">target_directory</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy files from list to a directory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    files : list of strings</span>
<span class="sd">            list of file names</span>
<span class="sd">    target_directory : string</span>
<span class="sd">                       name of destination folder</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">target_directory</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">target_directory</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: destination folder &quot;</span> <span class="o">+</span> <span class="n">target_directory</span> <span class="o">+</span> <span class="s2">&quot; does not &quot;</span> <span class="o">+</span>
              <span class="s2">&quot;exist. Please create it first.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_files"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.get_files">[docs]</a><span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="n">data_directory</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Getting all files in the directory and subdirectories matching some pattern (&#39;.txt&#39; for example)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_directory : string</span>
<span class="sd">                     name of folder that will be searched through</span>
<span class="sd">    pattern: string</span>
<span class="sd">             string that should be substring of relevant filenames</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    filenames : list of strings</span>
<span class="sd">                list of file names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">data_directory</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">filenames</span></div>


<div class="viewcode-block" id="reduce_file_size"><a class="viewcode-back" href="../../../tools.html#udkm.tools.functions.reduce_file_size">[docs]</a><span class="k">def</span> <span class="nf">reduce_file_size</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">decimals</span><span class="p">,</span> <span class="n">filename_suffix</span><span class="o">=</span><span class="s1">&#39;_compressed&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduce number of decimal places for all entries in a data file. If filename_suffix equals &#39;&#39;</span>
<span class="sd">    the existing file will be overwritten.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : string</span>
<span class="sd">               name of file that will be read</span>
<span class="sd">    decimals: integer</span>
<span class="sd">              number of decimal places</span>
<span class="sd">    filename_suffix: string</span>
<span class="sd">                     string that will be added at the end of the original filename before saving</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">decimals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">splitted_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">new_filename</span> <span class="o">=</span> <span class="n">splitted_filename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">filename_suffix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">splitted_filename</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">new_filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
</pre></div>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Alexander von Reppert<br/>
  
      &copy; Copyright 2022, Alexander von Reppert.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>